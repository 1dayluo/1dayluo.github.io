import{_ as k}from"./ValaxyMain.vue_vue_type_style_index_0_lang-DRVqeRiY.js";import{a as d,p as o,o as c,c as g,w as e,f as u,k as E,r as a,g as s,h as i}from"./app-CzjF7NIc.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-17i98rOK.js";import"./YunCard.vue_vue_type_script_setup_true_lang-Da3dkqK-.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-BsneHNVS.js";import"./index-C7yU5XnD.js";const y=s("h1",{id:"window-opener-学习",tabindex:"-1"},[i("window.opener 学习 "),s("a",{class:"header-anchor",href:"#window-opener-学习","aria-label":'Permalink to "window.opener 学习"'},"​")],-1),m=s("p",null,"[15:40]",-1),_=s("p",null,"关于window.opener的补充学习：",-1),F=s("p",null,[s("a",{href:"https://medium.com/tsscyber/penetration-testing-window-opener-xss-vectors-part-2-7810ebfccc1d%5D(https://medium.com/tsscyber/penetration-testing-window-opener-xss-vectors-part-2-7810ebfccc1d)",target:"_blank",rel:"noreferrer"})],-1),v=s("p",null,"还是从part1开始读起吧（",-1),f=s("p",null,"学习的过程偶尔会发愁，遇到很多英文，我还是一个头两个大。但是还是啃吧）：",-1),b=s("p",null,[i("part1："),s("a",{href:"https://medium.com/tsscyber/penetration-testing-window-opener-xss-vectors-part-1-c6be37701cab",target:"_blank",rel:"noreferrer"},"https://medium.com/tsscyber/penetration-testing-window-opener-xss-vectors-part-1-c6be37701cab")],-1),w=s("p",null,[i("和视频补充学习："),s("a",{href:"https://www.youtube.com/watch?v=veXDFx2qJBk",target:"_blank",rel:"noreferrer"},"https://www.youtube.com/watch?v=veXDFx2qJBk")],-1),C=s("p",null,[s("strong",null,"part1介绍的内容：")],-1),x=s("ul",null,[s("li",null,"opener 变量 以及如何与同源政策相关联。"),s("li",null,"该变量如何呗滥用以实现接近客户端重定向")],-1),A=s("p",null,[s("strong",null,"part2介绍的内容：")],-1),D=s("ul",null,[s("li",null,"在part1概念的基础上探讨新型XSS向量")],-1),B=s("p",null,[s("strong",null,"part3介绍的内容：")],-1),S=s("ul",null,[s("li",null,[i("来混淆一些有趣的跨窗口"),s("code",null,"eval"),i(" 函数 从而在第四部分讨论通用XSS的问题")])],-1),j=s("h1",{id:"part-1",tabindex:"-1"},[i("Part 1 "),s("a",{class:"header-anchor",href:"#part-1","aria-label":'Permalink to "Part 1"'},"​")],-1),P=s("h2",{id:"introducing-the-window-opener-variable",tabindex:"-1"},[i("Introducing the window.opener variable "),s("a",{class:"header-anchor",href:"#introducing-the-window-opener-variable","aria-label":'Permalink to "Introducing the window.opener variable"'},"​")],-1),U=s("p",null,"open 函数通常被用于在弹出的窗口中打开一个URL。这个函数经常被不良的网站打开烦人或恶意的广告，但是同样也有合法的使用。当你调用open函数，浏览器自动在新窗口中赋值一个变量指向打开该窗口的源窗口。这个变量自然地称作”opener‘",-1),T=s("p",null,"其中之一的opener变量的合法使用是让单点登录函数无需离开当前页面。这个过程像这样：",-1),I=s("p",null,"（Notion不支持gif，见原始网页）",-1),X=s("figure",null,[s("img",{src:"https://i.loli.net/2021/08/27/MhPyvB1ex254aJw.png",alt:"Untitled",loading:"lazy",decoding:"async"})],-1),R=s("p",null,"上面的动画有一组有趣的事情值得注意：",-1),L=s("ol",null,[s("li",null,[s("code",null,"oepner"),i("变量在被右边弹出窗口的第一个域名时就被赋值了（opener指向原始window），并一直"),s("strong",null,"持续"),i("到新页面的加载（‘"),s("a",{href:"https://singlesignonprov",target:"_blank",rel:"noreferrer"},"https://singlesignonprov"),i("…’ -> ‘"),s("a",{href:"http://xss.vg?token=abc%E2%80%A6%E2%80%99",target:"_blank",rel:"noreferrer"},"http://xss.vg?token=abc…’"),i(") 这不同于大多数javascript的变量：通常他们不会持续到当前窗口加载新页面。")]),s("li",null,[i("单点登陆重定向到original domain是在利"),s("code",null,"opener"),i(" 变量与original window交互之前的。The single sign-on provider redirects back to the original domain before utilising the opener variable to communicate with the original window")])],-1),W=s("p",null,[i("为什么单点登陆不提供简单的"),s("code",null,"opener"),i("变量去发送登陆token重定向到original window，像"),s("code",null,"opener.token"),i(" ?因为这个违背同源政策。")],-1),M=s("h2",{id:"the-same-origin-policy-and-pop-up-windows",tabindex:"-1"},[i("The same origin policy and pop-up windows "),s("a",{class:"header-anchor",href:"#the-same-origin-policy-and-pop-up-windows","aria-label":'Permalink to "The same origin policy and pop-up windows"'},"​")],-1),z=s("p",null,"要利用opener变量在另一个window中进行更改，任何windows都要满足以下三个检查：",-1),$=s("ol",null,[s("li",null,"Same domain (e.g. tsscyber.com.au)"),s("li",null,"Same URL scheme (e.g. HTTP, HTTPS, FTP etc)"),s("li",null,"Same port (usually 80 for HTTP and 443 for HTTPS)")],-1),V=s("p",null,"如果你跳过了三个检查你就跳过了同源政策，浏览器将允许javascript去在windows之间执行（同样的检查被用于javascript与iframes或其他嵌入内容进行交互）",-1),H=s("p",null,[i("例如，假设你是一个坏家伙，你构建了一个恶意网站（"),s("a",{href:"http://xss.vg/",target:"_blank",rel:"noreferrer"},"http://xss.vg:80"),i(" in this example)，当有人浏览你的网站时，Javascript将打开弹出的窗口，然后将受害者的gmail账户加载进opener。你的恶意javascript尝试用"),s("code",null,"opener.document.body.innerHTML"),i(" 读取受害者的邮件或类似的事情。")],-1),O=s("p",null,[i("不幸的是，用"),s("code",null,"opener"),i("变量读去gmail所在窗口的数据违背了全部的三个同源政策。而且浏览器安全控制将阻止未授权的访问。")],-1),J=s("h2",{id:"same-origin-check-example",tabindex:"-1"},[s("strong",null,"Same origin check example"),i(),s("a",{class:"header-anchor",href:"#same-origin-check-example","aria-label":'Permalink to "**Same origin check example**"'},"​")],-1),q=s("p",null,[s("em",null,[s("a",{href:"http://xss.vg:80",target:"_blank",rel:"noreferrer"},"http://xss.vg:80")]),i(" "),s("strong",null,"VS"),i(" "),s("em",null,[s("a",{href:"https://mail.google.com:443",target:"_blank",rel:"noreferrer"},"https://mail.google.com:443")])],-1),N=s("ol",null,[s("li",null,"Domain: xss.vg != mail.google.com"),s("li",null,"URL Scheme: HTTP != HTTPS"),s("li",null,"Port: 80 != 443")],-1),Z=s("h2",{id:"safe-cross-domain-operations",tabindex:"-1"},[i("’Safe‘cross-domain operations "),s("a",{class:"header-anchor",href:"#safe-cross-domain-operations","aria-label":'Permalink to "’Safe‘cross-domain operations"'},"​")],-1),G=s("p",null,"你能够读取修改跨域窗口这很明显是一个安全问题，这有一组函数和方法是由浏览器提供的尽管同源检查是失败的。以下是我所知道的安全跨域 操作/函数：",-1),Q=s("ol",null,[s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/blur",target:"_blank",rel:"noreferrer"},"blur"),i(" — shifts focus away from the window")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/close",target:"_blank",rel:"noreferrer"},"close"),i(" — closes the window (but only if it was opened by JavaScript)")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/closed",target:"_blank",rel:"noreferrer"},"closed"),i(" — indicates if the windows was closed")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/focus",target:"_blank",rel:"noreferrer"},"focus"),i(" — focuses the window (but doesn’t always focus the window…)")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/frames",target:"_blank",rel:"noreferrer"},"frames"),i(" — same as "),s("em",null,"opener")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/length",target:"_blank",rel:"noreferrer"},"length"),i(" — the number of iframes in the "),s("em",null,"opener")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/location",target:"_blank",rel:"noreferrer"},"location"),i(" — write-only access to the "),s("em",null,"opener’s"),i(" URL")]),s("li",null,[i("opener — the "),s("em",null,"opener’s opener"),i(" (or null if it doesn’t have one)")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/parent",target:"_blank",rel:"noreferrer"},"parent"),i(" — gets the "),s("em",null,"opener’s"),i(" parent window (which might be itself)")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",target:"_blank",rel:"noreferrer"},"postMessage"),i(" — the safe way to do cross origin communication")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/self",target:"_blank",rel:"noreferrer"},"self"),i(" — I’m not entirely sure on the usage of this one. Is apparently useful for web workers")]),s("li",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/top",target:"_blank",rel:"noreferrer"},"top"),i(" — the "),s("em",null,"opener’s"),i(" top window (which might be itself)")])],-1),Y=s("p",null,"Of these 12 safe cross-domain operations/variables, number 7: ‘location’ and the ability to access the opener’s iframes is of particular interest.",-1),K=s("h2",{id:"messing-with-cross-origin-locations",tabindex:"-1"},[i("Messing with cross-origin locations "),s("a",{class:"header-anchor",href:"#messing-with-cross-origin-locations","aria-label":'Permalink to "Messing with cross-origin locations"'},"​")],-1),ss=s("p",null,"首先潜在的问题需要想到的是通过将opener的location值改为javascript或者Data URI来获得写权限。我们上面的例子中，以下命令达到了同样的效果：",-1),is=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.secretValue")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'javascript:window.secretValue'"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //note the use of window.secretValue here as opposed to opener.secretValue as the goal is for the JavaScript to run in the context of the opener's window")])])]),s("button",{class:"collapse"})],-1),es=s("p",null,[i("注意，这里location是"),s("code",null,"window.scretValue"),i("而不是"),s("code",null,"opner.scretValue"),i(" 是因为当前javascript运行的上下文在opener的窗口（原）")],-1),ts=s("p",null,"幸运的是浏览器已经想到这个变量而且这个命令会造成安全性报错。等同于的功能用URI实现像这样：",-1),as=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'data:text/html,<script>window.secretValue<\/script>'")])])]),s("button",{class:"collapse"})],-1),ls=s("p",null,"但是，这里有两个问题。",-1),ns=s("p",null,[i("第一，URI结构造成了opener指向的window去重载导致所有用户定义的变量重置为了"),s("code",null,"undefined"),i(" （例如，window.secretValue丢失了）。将当前窗口的上下文的域名变为弹出窗口的上下文（this is opposed to a JavaScript URI which doesn’t always cause the window to reload/change context）")],-1),hs=s("p",null,"第二，大多浏览器禁用顶层窗口被导航到URI数据。如果你尝试这个导航在Chrome不会发生任何事情（一个报错信息会在console中打印），在firefox中造成了窗口关闭（也许是bug）",-1),os=s("p",null,[i("你仍然被允许用data URIs在被嵌入的目标中（例如一个iframe）。由于我们可以访问"),s("code",null,"opener.length"),i(" ，我们可以知道我们打开的窗口是否包含任何iframes。你可以用index来获得iframe，例如 "),s("code",null,"var openersFirstIframe = opener[0]"),i(" 将会获得opner所在窗口的第一个iframe。然而，尝试跨域设置iframe的location会因为浏览器的安全规则拒绝。除非你在opner本身所在或者是它的parent。")],-1),rs=s("p",null,[i("即使浏览器已阻止了XSS利用location的能力，你仍然可以导航opener去任何你想去的域名（例如"),s("code",null,"opner.location='http://xss.vg'"),i(" ) 这是一种客户端的重定向，恶意网站能够劫持另一个window/tab的导航来强迫用户浏览制定网站（有趣的是，在写这个的时候，chrome禁止了在用户导航到另一个页面后，改变opener的location。这一步在我看来是朝着正确的方向）")],-1),ps=s("p",null,"我见过有程序用半合法化的方式去绕过弹出限制，看起来弹出窗口阻止程序对于弹出窗口的合法（或是否垃圾邮件）性有一些启发式看法。所以一些网站加载自己到弹出窗口中，而将原始窗口导航到广告网站。这个欺骗了弹出窗口组织程序，因为弹出的窗口不包含垃圾信息，但原始网站有。",-1),ks=s("h2",{id:"the-story-so-far",tabindex:"-1"},[i("The story so far "),s("a",{class:"header-anchor",href:"#the-story-so-far","aria-label":'Permalink to "The story so far"'},"​")],-1),ds=s("p",null,"到目前为止我们已经讨论了弹出窗口和opener变量。我们看到了浏览器实现了安全控制：基于同源控制阻止javascript执行发生在windows之间。除了a poor person’s client side open redirect issue，opener变量看起来能够安全使用且避免邪恶用途。part2将扩展我们的知识：如何我们用新的变量实现XSS。",-1),cs=s("h1",{id:"part2",tabindex:"-1"},[i("part2 "),s("a",{class:"header-anchor",href:"#part2","aria-label":'Permalink to "part2"'},"​")],-1),gs=s("p",null,[i("tldr;"),s("code",null,"opener.location.*"),i(" 和 "),s("code",null,"onhashchange"),i(" 事件都是XSS向量。都存在于旧版本的reveal.js中。")],-1),us=s("p",null,"这是四部分中的第二部分：探索与弹出窗口相关连的安全概念和javascript opner变量。这部分假设你已阅读过第一部分。在第一部分我们总结了唯一的安全问题与opener相关连的是poor-mans 客户端开放重定向。",-1),Es=s("h2",{id:"opener-location-dom-xss",tabindex:"-1"},[i("opener.location DOM XSS "),s("a",{class:"header-anchor",href:"#opener-location-dom-xss","aria-label":'Permalink to "opener.location DOM XSS"'},"​")],-1),ys=s("p",null,"我们的目标是滥用我们对于location变量的控制去欺骗客户端javascript以执行我们控制js命令。一个很明显的且有名的方式是location值能够在 application以不安全的方式注入它的值时被 滥用。例如，以下的javascript片段创建了一个a标签：源自window的当前location",-1),ms=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"document.body.innerHTML "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},` "<a href='"`),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," window.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},` "/nextPage'>unsafe!</a>"`)])])]),s("button",{class:"collapse"})],-1),_s=s("p",null,"特制的URL能够实现XSS，例如",-1),Fs=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"http"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//xss.vg/'onClick='alert(1)")])])]),s("button",{class:"collapse"})],-1),vs=s("p",null,"将会被DOM树呈现：",-1),fs=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"a"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," href"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http://xss.vg/"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," onClick"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"alert(1)"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," nextpage"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'""'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">unsafe!</"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"a"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),s("button",{class:"collapse"})],-1),bs=s("p",null,[i("要注意到href标签如何变成"),s("code",null,"http://xss.vg"),i(" 以"),s("code",null,"onClick")],-1),ws=s("p",null,"javascript handler被作为额外的标签属性被注入进去的。(If this makes no sense to you I suggest you go and read up about XSS Basics and DOM based XSS).",-1),Cs=s("p",null,"如果我们改变了这段javascript片段为opener呢？它仍然存在漏洞么？",-1),xs=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"document.body.innerHTML "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},` "<a href='"`),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},` "/nextPage'>unsafe!</a>"`)])])]),s("button",{class:"collapse"})],-1),As=s("p",null,"当我们用我们的恶意URL尝试上面的片段，我们获取了关于opener变量不存在的报错。",-1),Ds=s("figure",null,[s("img",{src:"https://i.loli.net/2021/08/27/nCvJDWT69LzOYxS.png",alt:"Untitled",loading:"lazy",decoding:"async"})],-1),Bs=s("p",null,"解决这个问题我们需要确保javascript尝试使用它之前去定义opener变量。最明显的方法是用open函数填充变量以加载恶意URL。但，",-1),Ss=s("ul",null,[s("li",null,"不具备执行javascript能力的有易受攻击页面上如何运行open方法"),s("li",null,"如何欺骗受害者访问我们的控制的页面，以及如何从我们自己的网站调用open方法")],-1),js=s("p",null,"但是这些也行不通，因为易受攻击的网站尝试去从我们的网站读location的值时，这个行为会因为违背同源政策而被浏览器阻止。（bad site是opener，然后对方网站读取opener.location)",-1),Ps=s("p",null,"这里有两个方法能够解决我们的同源政策问题。",-1),Us=s("p",null,[i("用"),s("code",null,"_self"),i(" 关键字能够让我们打开恶意链接时，让opener指向我们自己的窗口。")],-1),Ts=s("p",null,[s("code",null,"_self"),i(" 标签将导致URL被当前窗口加载并会填充opner变量。当易受攻击的javascript遇到"),s("code",null,"opener.location"),i(" 变量时就相当于是"),s("code",null,"window.location"),i(" 。于是我们的XSS攻击像这样：")],-1),Is=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"open"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`"http://xss.vg/'onClick='alert(1)"`),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"_self"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),s("button",{class:"collapse"})],-1),Xs=s("p",null,[i("这个策略在chrome和firefox中有用，edge无用，在edge下，即使用"),s("code",null,"_self"),i(" 加载了新页面但是也不会填充opener变量。在edge下生效，需要一些小技巧（混淆）")],-1),Rs=s("p",null,"我们的目标不是完全的绕过同源政策，this would be a zero day in the browser’s security model。相反，我们需要对窗口进行一些设置使得他们满足同源政策。我们需要：",-1),Ls=s("ul",null,[s("li",null,"bad site open bad site（满足同源政策）、"),s("li",null,"修改opener所在的location为payload"),s("li",null,"修改opener定义处所在窗口的location目标域名（到此步满足同源政策）")],-1),Ws=s("h2",{id:"onhashchange-event-xss",tabindex:"-1"},[i("onhashchange event XSS "),s("a",{class:"header-anchor",href:"#onhashchange-event-xss","aria-label":'Permalink to "onhashchange event XSS"'},"​")],-1),Ms=s("p",null,[i("有一个经常被客户端的javascript使用的URL元素是"),s("code",null,"location.hash"),i(" ，如果我们尝试给跨域窗口设置hash，浏览器安全控制将介入并阻止我们。")],-1),zs=s("figure",null,[s("img",{src:"https://i.loli.net/2021/08/27/z9dtGSx5Vq4MemQ.png",alt:"Untitled",loading:"lazy",decoding:"async"})],-1),$s=s("p",null,"如果我们间接地将hash值包含在完整的URL中我们可以设置hash，像这样：",-1),Vs=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "http://xss.vg/#HashValueHere"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),s("button",{class:"collapse"})],-1),Hs=s("p",null,"关于hash片段，一个有趣的是，当它是URL的一部分时，改变它并不能触发页面重载。",-1),Os=s("p",null,"以下三个url后两个都会导致页面重载。第一个会触发onhashchange事件。",-1),Js=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "#first"'),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //doesn't trigger a page reload, will focus the element with the id 'first' if it exists and trigger an onhashchange event")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "/oops"'),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //causes the page to reload as the pathname has changed")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "?oops"'),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //causes the page to reload as the search (query string) has changed")])])]),s("button",{class:"collapse"})],-1),qs=s("p",null,"如果我们在opener的location做同样的事情会怎么样呢？",-1),Ns=s("p",null,"如下，最后一个会触发onhanshchange。只有第一个会被阻止报错。",-1),Zs=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "#first"'),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //error, we aren't allowed to read the value of opener.location")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "http://vulnsite/"'),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //this is ok")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"opener.location "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "http://vulnsite/#hash change"'),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //triggers onhashchange event on the opener's window!")])])]),s("button",{class:"collapse"})],-1),Gs=s("p",null,"一些网站会监控hash值，以在application中作出对应的逻辑判断。例如，在gmail中，gmail会在实现查询邮件的时候用hash值",-1),Qs=s("figure",null,[s("img",{src:"https://i.loli.net/2021/08/27/ne1Fl3Asvqt8OpM.png",alt:"Untitled",loading:"lazy",decoding:"async"})],-1),Ys=s("p",null,"能够在gmail进行跨域搜索并不会让攻击者能够做任何邪恶的事情。但，这个并不是XSS。虽然一个域的javascript会导致另一个域的做一些事情，但我们无法在gmail域中执行一些额外的javascript命令。下面是一个简单的script片段，将会导致你的gmail实现跨域改变hash",-1),Ks=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"index "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setInterval"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {  ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'you+have+been+hacked++++++'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";  ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," url "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "https://mail.google.com/mail/u/0/#search/"'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"substr"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", index"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," %"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash."),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"length"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");  ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    open"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(url,"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'gmailPopup'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),s("button",{class:"collapse"})],-1),si=s("p",null,[s("code",null,"open(url,'gmailPopup')"),i(" 函数的第二个参数gmailPopup是用来给弹出窗口命名的。通过此参数，浏览器会首先检查是否有叫gmailPopup的窗口存在，如果存在，会设置location的值为第一个参数下的url而不是创建一个新的弹出窗口。这个很重要，如果每次都创建新的弹出窗口，每个窗口都会有不同的hash值。而只有一个窗口意味着你只需改变一个现存窗口的hash值。")],-1),ii=s("p",null,[i("为什么我们要改变hash值而不是加载有特定hash值的窗口？因为这样我们能够用我们控制的hash值在window中触发"),s("code",null,"onhashchange"),i(" 事件。思考以下javascript片段：用hash值的改变去聚焦页面的不同元素：")],-1),ei=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"location.hash "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(window)."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"on"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'hashchange'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  $"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(location.hash."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"split"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'#'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"])."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"focus"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"});")])])]),s("button",{class:"collapse"})],-1),ti=s("p",null,[i("对于以上的代码，只改变location（["),s("code",null,"http://vulnerable/#](http://vulnerable/#)<img src=x onerrer=alert() />"),i(" ）是不够的，还需要触发hash值的改变。你可以像这样：")],-1),ai=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," payload "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "#<img src=x onerror=alert()/>"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"open"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(vulnerablePage, "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"popup"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//give the vulnerable page a few seconds to fully load before changing the hash value")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setTimeout"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"open"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(vulnerablePage "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," payload, "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"popup"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2000"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"collapse"})],-1),li=s("p",null,"这变得更加有趣，因为甚至很多开发者都会忽略掉这个安全问题。",-1),ni=s("h2",{id:"example-of-unsafe-opener-usage-—-reveal-js",tabindex:"-1"},[i("Example of unsafe opener usage — Reveal.js "),s("a",{class:"header-anchor",href:"#example-of-unsafe-opener-usage-—-reveal-js","aria-label":'Permalink to "Example of unsafe opener usage — Reveal.js"'},"​")],-1),hi=s("p",null,[i("在这个阶段你可能在想：这样的代码真的存在么？我也是这样想的，然后通过谷歌搜索发现旧版的"),s("code",null,"reveal.js"),i(" 有着基于DOM的XSS问题：通过使用"),s("code",null,"opener.location"),i(" 变量在presenter notes functionality (versions prior to v2.6.0).以下是这个易受攻击的代码行：")],-1),oi=s("p",null,[s("a",{href:"https://github.com/hakimel/reveal.js/blob/4164200474e2af27803dc7683054f5443743c8a9/plugin/notes/notes.html#L142",target:"_blank",rel:"noreferrer"},"https://github.com/hakimel/reveal.js/blob/4164200474e2af27803dc7683054f5443743c8a9/plugin/notes/notes.html#L142")],-1),ri=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"document."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"( "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`'<iframe width="1280" height="1024" id="current-slide" src="'`),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," window.opener.location.href "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`'"></iframe>'`),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," );")])])]),s("button",{class:"collapse"})],-1),pi=s("p",null,"对于这段代码，XSS攻击有一些难度：我们需要逃逸src属性下的双引号（“）。",-1),ki=s("p",null,"在URL编码中，双引号是 %22,同样的，<和>也是要编码。URL像这样",-1),di=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"http"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'//xss.vg/"></iframe><script>alert()<\/script>')])])]),s("button",{class:"collapse"})],-1),ci=s("p",null,"在HTML中会变成这样：",-1),gi=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"iframe"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," width"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"1280"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," height"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"1024"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," id"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"current-slide"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," src"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http://xss.vg/%22%3e%3c/iframe%3e%3cscript%3ealert()%%3c/script3e"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"></"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"iframe"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),s("button",{class:"collapse"})],-1),ui=s("p",null,[i("这是XSS安全的。然而，同一时间，我发现了这个问题"),s("code",null,"**hash"),i(" 在chrome和edge中是不会被URL编码的。**")],-1),Ei=s("p",null,"所以以下的url",-1),yi=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"http"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'//xss.vg/#"></iframe><script>alert()<\/script>')])])]),s("button",{class:"collapse"})],-1),mi=s("p",null,"将会变成",-1),_i=s("div",{class:"language-jsx vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"jsx"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"iframe"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," width"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"1280"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," height"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"1024"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," id"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"current-slide"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," src"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http://xss.vg/#"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"></"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"iframe"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"><"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"script"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">alert()</"),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"script"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"</iframe'),s("span",{style:{"--shiki-light":"#B31D28","--shiki-dark":"#FDAEB7","--shiki-light-font-style":"italic","--shiki-dark-font-style":"italic"}},">")])])]),s("button",{class:"collapse"})],-1),Fi=s("p",null,"alert()的XSS会被出发。在写作的同一时间，chrome改变了hash不进行编码的问题。但是edge和explorer仍然存在这个问题。",-1),vi=s("h2",{id:"the-story-so-far-1",tabindex:"-1"},[i("The story so far "),s("a",{class:"header-anchor",href:"#the-story-so-far-1","aria-label":'Permalink to "The story so far"'},"​")],-1),fi=s("p",null,"目前为止，我们讨论了弹出窗口和opener变量。我们看到浏览器一些安全控制像同源政策去阻止javascript在两个窗口之间执行。但是",-1),bi=s("p",null,[s("code",null,"opener.location"),i(" 变量能够被用于XSS向量，而且出发onhashChange事件。第三部分：Join me in part three (coming soon) as we play around with cross-window eval.")],-1),wi=s("p",null,"然后发现并没有part3，作者鸽了。。。pAq",-1),Ti={__name:"guan-yu-opener-de-xue-xi-ji-li-yong",setup(Ci,{expose:r}){const l=JSON.parse('{"title":"关于opener的学习及利用","description":"","frontmatter":{"title":"关于opener的学习及利用","date":"2021-08-27T08:01:04.000Z","tags":["技术阅读","XSS"],"published":true,"hideInList":false,"feature":null,"isTop":false},"headers":[{"level":2,"title":"Introducing the window.opener variable","slug":"introducing-the-window-opener-variable","link":"#introducing-the-window-opener-variable","children":[]},{"level":2,"title":"The same origin policy and pop-up windows","slug":"the-same-origin-policy-and-pop-up-windows","link":"#the-same-origin-policy-and-pop-up-windows","children":[]},{"level":2,"title":"Same origin check example","slug":"same-origin-check-example","link":"#same-origin-check-example","children":[]},{"level":2,"title":"’Safe‘cross-domain operations","slug":"safe-cross-domain-operations","link":"#safe-cross-domain-operations","children":[]},{"level":2,"title":"Messing with cross-origin locations","slug":"messing-with-cross-origin-locations","link":"#messing-with-cross-origin-locations","children":[]},{"level":2,"title":"The story so far","slug":"the-story-so-far","link":"#the-story-so-far","children":[]},{"level":2,"title":"opener.location DOM XSS","slug":"opener-location-dom-xss","link":"#opener-location-dom-xss","children":[]},{"level":2,"title":"onhashchange event XSS","slug":"onhashchange-event-xss","link":"#onhashchange-event-xss","children":[]},{"level":2,"title":"Example of unsafe opener usage — Reveal.js","slug":"example-of-unsafe-opener-usage-—-reveal-js","link":"#example-of-unsafe-opener-usage-—-reveal-js","children":[]},{"level":2,"title":"The story so far","slug":"the-story-so-far-1","link":"#the-story-so-far-1","children":[]}],"relativePath":"pages/posts/history/guan-yu-opener-de-xue-xi-ji-li-yong.md","path":"/home/runner/work/1dayluo.github.io/1dayluo.github.io/pages/posts/history/guan-yu-opener-de-xue-xi-ji-li-yong.md","lastUpdated":1714218709000}'),h=d(),n=l.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},l.frontmatter||{}),o("pageData",l),o("valaxy:frontmatter",n),globalThis.$frontmatter=n,r({frontmatter:{title:"关于opener的学习及利用",date:"2021-08-27T08:01:04.000Z",tags:["技术阅读","XSS"],published:!0,hideInList:!1,feature:null,isTop:!1}}),(t,Ai)=>{const p=k;return c(),g(p,{frontmatter:u(n)},{"main-content-md":e(()=>[y,m,_,F,v,f,b,w,C,x,A,D,B,S,j,P,U,E(" more "),T,I,X,R,L,W,M,z,$,V,H,O,J,q,N,Z,G,Q,Y,K,ss,is,es,ts,as,ls,ns,hs,os,rs,ps,ks,ds,cs,gs,us,Es,ys,ms,_s,Fs,vs,fs,bs,ws,Cs,xs,As,Ds,Bs,Ss,js,Ps,Us,Ts,Is,Xs,Rs,Ls,Ws,Ms,zs,$s,Vs,Hs,Os,Js,qs,Ns,Zs,Gs,Qs,Ys,Ks,si,ii,ei,ti,ai,li,ni,hi,oi,ri,pi,ki,di,ci,gi,ui,Ei,yi,mi,_i,Fi,vi,fi,bi,wi]),"main-header":e(()=>[a(t.$slots,"main-header")]),"main-header-after":e(()=>[a(t.$slots,"main-header-after")]),"main-nav":e(()=>[a(t.$slots,"main-nav")]),"main-content":e(()=>[a(t.$slots,"main-content")]),"main-content-after":e(()=>[a(t.$slots,"main-content-after")]),"main-nav-before":e(()=>[a(t.$slots,"main-nav-before")]),"main-nav-after":e(()=>[a(t.$slots,"main-nav-after")]),comment:e(()=>[a(t.$slots,"comment")]),footer:e(()=>[a(t.$slots,"footer")]),aside:e(()=>[a(t.$slots,"aside")]),"aside-custom":e(()=>[a(t.$slots,"aside-custom")]),default:e(()=>[a(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{Ti as default};
