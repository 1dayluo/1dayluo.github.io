import{_ as o}from"./ValaxyMain.vue_vue_type_style_index_0_lang-DRVqeRiY.js";import{a as d,p as k,o as c,c as g,w as t,f as E,r as a,g as i,h as s}from"./app-CzjF7NIc.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-17i98rOK.js";import"./YunCard.vue_vue_type_script_setup_true_lang-Da3dkqK-.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-BsneHNVS.js";import"./index-C7yU5XnD.js";const y=i("p",null,[i("s",null,"偷悄悄：其实是技术分享用的PPT大纲")],-1),u=i("p",null,[s("后续会在blog继续更一些之前看到的h1的xss构造攻击链为rce的文章（或许） 更新了文章："),i("a",{href:"https://1dayluo.github.io/post/xss-shui-ti-pian-guan-yu-dom-colbbering-yi-xie-ge-ren-li-jie/",target:"_blank",rel:"noreferrer"},"https://1dayluo.github.io/post/xss-shui-ti-pian-guan-yu-dom-colbbering-yi-xie-ge-ren-li-jie/"),s(" 下对于DOM clobbering的理解。")],-1),F=i("h2",{id:"从svg特性到高级xss利用",tabindex:"-1"},[s("从SVG特性到高级XSS利用 "),i("a",{class:"header-anchor",href:"#从svg特性到高级xss利用","aria-label":'Permalink to "从SVG特性到高级XSS利用"'},"​")],-1),m=i("h2",{id:"svg基础",tabindex:"-1"},[s("svg基础 "),i("a",{class:"header-anchor",href:"#svg基础","aria-label":'Permalink to "svg基础"'},"​")],-1),v=i("ul",null,[i("li",null,[i("p",null,[s("svg是最短的攻击向量 ： "),i("code",null,"<svg/onload=alert(1)>")])]),i("li",null,[i("p",null,"svg特性可利用在绕过上："),i("ul",null,[i("li",null,[i("p",null,"XML-ish")]),i("li",null,[i("p",null,"利用onload 和a绕过")])])])],-1),_=i("h3",{id:"xml-ish",tabindex:"-1"},[s("XML-ish "),i("a",{class:"header-anchor",href:"#xml-ish","aria-label":'Permalink to "XML-ish"'},"​")],-1),C=i("p",null,[s("它支持在两个svg标签里插入任何CDATA元素，其中包括 "),i("code",null,"<script>"),s(" 并被按照常规加载。")],-1),b=i("p",null,"题目：",-1),f=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," escape"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"input"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    //                      v-- frowny face")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    input "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," input."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"replace"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"[=(]"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"g"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"''"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ok seriously, disallows equal signs and open parenthesis")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," input;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),D=i("p",null,"过滤的场景：",-1),A=i("ul",null,[i("li",null,[i("p",null,"传统的一些攻击向量")]),i("li",null,[i("p",null,"“=” 被禁止：html标签下的属性")]),i("li",null,[i("p",null,"“=”被禁止：事件处理，包括on开头的系列：例如onload")]),i("li",null,[i("p",null,"左括号被禁止")])],-1),B=i("p",null,"没有考虑到的场景：",-1),j=i("ul",null,[i("li",null,"svg的XML-ish特性")],-1),x=i("p",null,"绕过利用了svg支持标签内插入任何CDATA元素。",-1),T=i("p",null,"在此之前先了解一下HTML解析机制：",-1),M=i("blockquote",null,[i("p",null,"一个HTML解析器作为一个状态机，它从输入流中获取字符并按照转换规则转换到另一种状态。在解析过程中，任何时候它只要遇到一个’<’符号（后面没有跟’/‘符号）就会进入“标签开始状态(Tag open state)”。然后转变到“标签名状态(Tag name state)”，“前属性名状态(before attribute name state)”……最后进入“数据状态(Data state)”并释放当前标签的token。当解析器处于“数据状态(Data state)”时，它会继续解析，每当发现一个完整的标签，就会释放出一个token。（原文内容）")],-1),L=i("p",null,"所以任何标签建立并解析的前提是被HTML解析器判定为”标签开始状态“。这也就是为什么不用svg，只是用16进制实体不能够触发alert，例如：",-1),S=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"div"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"&#60;"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"img src"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"&#x3d;"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"x onerror"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"&#x3d;"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"alert"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"&#x28;"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"1)"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"&#62;"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"div"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),i("button",{class:"collapse"})],-1),X=i("p",null,"在这种情况下，「字符引用」不会判定为标签开始状态，也就不会建立新标签并解析标签。",-1),w=i("p",null,[s("像将实体编码放入 "),i("code",null,"script"),s(" 标签里也不可以：")],-1),H=i("div",{class:"language- vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"<script>&#97;&#108;&#101;&#114;&#116&#40;&#57;&#41;&#59<\/script>")])])]),i("button",{class:"collapse"})],-1),$=i("p",null,"因为script标签属于HTML里五类元素里的 原始文本元素，不支持解析字符引用。",-1),R=i("p",null,"（五类：原始文本元素，RCDATA，空元素，外部元素，基本元素）",-1),P=i("p",null,"那么，svg的XML-ish意味着什么呢？ 首先明确svg是属于外部元素的。",-1),O=i("p",null,[s("XML-ish代表："),i("code",null,"<svg>"),s("遵循XML的定义。"),i("br"),s(" 在XML中实体会自动转义,除了"),i("code",null,"<![CDATA["),s("和"),i("code",null,"]]>"),s("包含的实体，所以最后的payload为：")],-1),I=i("div",{class:"language- vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"<svg><script>prompt&#x28;1)<\/script></svg>")])])]),i("button",{class:"collapse"})],-1),N=i("h2",{id:"注释逃逸-html5",tabindex:"-1"},[s("注释逃逸：HTML5 "),i("a",{class:"header-anchor",href:"#注释逃逸-html5","aria-label":'Permalink to "注释逃逸：HTML5"'},"​")],-1),V=i("p",null,"题目",-1),q=i("div",{class:"language- vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"function escape(input) {")]),s(`
`),i("span",{class:"line"},[i("span",null,"    // filter potential comment end delimiters")]),s(`
`),i("span",{class:"line"},[i("span",null,"    input = input.replace(/->/g, '_');")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,"    // comment the input to avoid script execution")]),s(`
`),i("span",{class:"line"},[i("span",null,"    return '<!-- ' + input + ' -->';")]),s(`
`),i("span",{class:"line"},[i("span",null,"}")])])]),i("button",{class:"collapse"})],-1),U=i("p",null,"这里用HTML5对于注释的标准来绕过",-1),J=i("blockquote",null,[i("p",null,"But, as it was first noted in 2012, HTML5 comments are a little bit special. Not only --> but also the character sequence --!>  has the ability to close comments and thereby it possible to bypass this filter as well.")],-1),Z=i("p",null,"payload:",-1),G=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"--!>"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"svg"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"onload"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"prompt"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])]),i("button",{class:"collapse"})],-1),z=i("h2",{id:"dom-clobbering-从html-injection到-javascript-injection",tabindex:"-1"},[s("DOM Clobbering：从html injection到 javascript injection "),i("a",{class:"header-anchor",href:"#dom-clobbering-从html-injection到-javascript-injection","aria-label":'Permalink to "DOM Clobbering：从html injection到 javascript injection"'},"​")],-1),K=i("p",null,"题目",-1),Q=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," escape"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"input"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // let's do a post redirection")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // pass in formURL#formDataJSON")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'        // e.g. http://httpbin.org/post#{"name":"Matt"}')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," segments "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," input."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"split"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'#'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," formURL "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," segments["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"];")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," formData "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," JSON"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"parse"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(segments["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," form "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," document."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"createElement"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'form'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        form.action "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," formURL;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        form.method "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'post'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"in"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," formData) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," input "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," form."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"appendChild"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(document."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"createElement"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'input'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            input.name "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            input."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setAttribute"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'value'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", formData[i]);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," form.outerHTML "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '                         "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<script>                                                  "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    // forbid javascript: or vbscript: and data: stuff    "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    if (!/script:|data:/i.test(document.forms[0].action)) "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"        document.forms[0].submit();                       "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    else                                                  "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'        document.write("Action forbidden.")               '),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<\/script>                                                 "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"        '"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (e) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'Invalid form data.'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),W=i("p",null,[s("读取代码，可以发现，会用"),i("code",null,"#"),s(" 对input进行分割，前半部分为form的action的值，后半部分插入到"),i("code",null,"<input>"),s(" 标签内。并且这一切生成 outerHTML里。")],-1),Y=i("p",null,"可以看到，即使action注入了script也由于下面的if判断无法触发，那么该怎么办呢？",-1),ii=i("p",null,"这里用了标准下HTMLCollection的特性：",-1),si=i("blockquote",null,[i("p",null,"The namedItem(key) method steps are: If key is the empty string, return null. Return the first element in the collection for which at least one of the following is true: it has an ID which is key; it is in the HTML namespace and has a name attribute whose value is key; or null if there is no such element.")],-1),ti=i("p",null,[s("重点在”Return the first element in the collection for which at least one of the following is true:“ 这句，下面有三个条件，满足一个即可。这里这道题我们用的是第三个条件，利用inputi标签name这个attribute。HTML解析会返回先搜索到的第一个属性名称为要查询的关键字（ "),i("code",null,"document.forms[0].action"),s(" )")],-1),li=i("div",{class:"language- vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,'javascript:prompt(1)#{"action":1}')])])]),i("button",{class:"collapse"})],-1),ai=i("p",null,"HTML看起来是这样的",-1),ni=i("figure",null,[i("img",{src:"https://i.imgur.com/ZeIxUr0.png",alt:"",loading:"lazy",decoding:"async"})],-1),ei=i("p",null,[s("这里我们取 "),i("code",null,"document.forms[0].action"),s(" 取到的是")],-1),hi=i("figure",null,[i("img",{src:"https://i.imgur.com/SvBaZBR.png",alt:"",loading:"lazy",decoding:"async"})],-1),ki=i("h2",{id:"利用自动补全绕过js语法",tabindex:"-1"},[s("利用自动补全绕过js语法 "),i("a",{class:"header-anchor",href:"#利用自动补全绕过js语法","aria-label":'Permalink to "利用自动补全绕过js语法"'},"​")],-1),pi=i("p",null,"题目",-1),ri=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," escape"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"input"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // tags stripping mechanism from ExtJS library")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // Ext.util.Format.stripTags")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," stripTagsRE "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#DBEDFF"}},"<"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D","--shiki-light-font-weight":"bold","--shiki-dark-font-weight":"bold"}},"\\/"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"["),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"^"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},">]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#DBEDFF"}},">"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"gi"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    input "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," input."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"replace"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(stripTagsRE, "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"''"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '<article>'"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," input "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '</article>'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),oi=i("p",null,[s("这里它用正则表达式的 "),i("code",null,"gi"),s(" 限定了大小写不敏感匹配，但是，它没有考虑到不完整的标签")],-1),di=i("p",null,"我们用不完整的注入",-1),ci=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"svg"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"onload"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"prompt"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"collapse"})],-1),gi=i("p",null,[s("这里HTML会自动补全后面的 "),i("code",null,">")],-1),fi={__name:"xss-jin-jie-xue-xi-fen-xiang-yi",setup(Ei,{expose:p}){const n=JSON.parse('{"title":"XSS进阶学习分享（一）","description":"","frontmatter":{"title":"XSS进阶学习分享（一）","date":"2023-02-07T10:14:01.000Z","tags":["XSS","笔记","知识点巩固","学习笔记"],"published":true,"hideInList":false,"feature":null,"isTop":false},"headers":[{"level":2,"title":"从SVG特性到高级XSS利用","slug":"从svg特性到高级xss利用","link":"#从svg特性到高级xss利用","children":[]},{"level":2,"title":"svg基础","slug":"svg基础","link":"#svg基础","children":[{"level":3,"title":"XML-ish","slug":"xml-ish","link":"#xml-ish","children":[]}]},{"level":2,"title":"注释逃逸：HTML5","slug":"注释逃逸-html5","link":"#注释逃逸-html5","children":[]},{"level":2,"title":"DOM Clobbering：从html injection到 javascript injection","slug":"dom-clobbering-从html-injection到-javascript-injection","link":"#dom-clobbering-从html-injection到-javascript-injection","children":[]},{"level":2,"title":"利用自动补全绕过js语法","slug":"利用自动补全绕过js语法","link":"#利用自动补全绕过js语法","children":[]}],"relativePath":"pages/posts/history/xss-jin-jie-xue-xi-fen-xiang-yi.md","path":"/home/runner/work/1dayluo.github.io/1dayluo.github.io/pages/posts/history/xss-jin-jie-xue-xi-fen-xiang-yi.md","lastUpdated":1714218709000}'),h=d(),e=n.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},n.frontmatter||{}),k("pageData",n),k("valaxy:frontmatter",e),globalThis.$frontmatter=e,p({frontmatter:{title:"XSS进阶学习分享（一）",date:"2023-02-07T10:14:01.000Z",tags:["XSS","笔记","知识点巩固","学习笔记"],published:!0,hideInList:!1,feature:null,isTop:!1}}),(l,ui)=>{const r=o;return c(),g(r,{frontmatter:E(e)},{"main-content-md":t(()=>[y,u,F,m,v,_,C,b,f,D,A,B,j,x,T,M,L,S,X,w,H,$,R,P,O,I,N,V,q,U,J,Z,G,z,K,Q,W,Y,ii,si,ti,li,ai,ni,ei,hi,ki,pi,ri,oi,di,ci,gi]),"main-header":t(()=>[a(l.$slots,"main-header")]),"main-header-after":t(()=>[a(l.$slots,"main-header-after")]),"main-nav":t(()=>[a(l.$slots,"main-nav")]),"main-content":t(()=>[a(l.$slots,"main-content")]),"main-content-after":t(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":t(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":t(()=>[a(l.$slots,"main-nav-after")]),comment:t(()=>[a(l.$slots,"comment")]),footer:t(()=>[a(l.$slots,"footer")]),aside:t(()=>[a(l.$slots,"aside")]),"aside-custom":t(()=>[a(l.$slots,"aside-custom")]),default:t(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{fi as default};
