import{_ as c}from"./ValaxyMain.vue_vue_type_style_index_0_lang-DRVqeRiY.js";import{a as u,p as i,o as p,c as m,w as s,f,r as a,g as e,h as t}from"./app-CzjF7NIc.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-17i98rOK.js";import"./YunCard.vue_vue_type_script_setup_true_lang-Da3dkqK-.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-BsneHNVS.js";import"./index-C7yU5XnD.js";const g=e("p",null,"困困更blog…… 之前拿着本来要发blog的文章去“换”了一个会员…其实我不太喜欢闭源小圈子分享（虽然能换积分/社区认同），我还是喜欢自己博客发，要么不发…小透明的坚持，等找工作/需要交换资源需要再说= = 目前还是一个能自闭就自闭的宅宅一枚 一写blog才知道自己语言表达有多差，尽请谅解。顺便强调 学习笔记 。都是学别人的呜呜，我只是整理在了一起，做个整理工。",-1),b=e("h2",{id:"xss-pdf-ssrf",tabindex:"-1"},[t("XSS+PDF==SSRF "),e("a",{class:"header-anchor",href:"#xss-pdf-ssrf","aria-label":'Permalink to "XSS+PDF==SSRF"'},"​")],-1),_=e("p",null,[t("来自："),e("a",{href:"https://docs.google.com/presentation/d/1JdIjHHPsFSgLbaJcHmMkE904jmwPM4xdhEuwhy2ebvo/htmlpresent",target:"_blank",rel:"noreferrer"},"https://docs.google.com/presentation/d/1JdIjHHPsFSgLbaJcHmMkE904jmwPM4xdhEuwhy2ebvo/htmlpresent")],-1),k=e("p",null,"通常pdf生成不是直接生成的，需要通过一些微调。",-1),y=e("blockquote",null,[e("p",null,"The attack strategy used will depend on what conversion system is in use in the application, but these can be broken into two categories: Headless browsers and HTML renderers.")],-1),w=e("p",null,"补充：之前还遇到pdf根据yml文件生成，构造恶意yml文件，从而导致任意命令执行（Ruby漏洞）",-1),v=e("h3",{id:"headless-browsers-html-renderers",tabindex:"-1"},[t("Headless Browsers & HTML Renderers "),e("a",{class:"header-anchor",href:"#headless-browsers-html-renderers","aria-label":'Permalink to "Headless Browsers & HTML Renderers"'},"​")],-1),S=e("p",null,[e("strong",null,"Headless Browsers")],-1),P=e("p",null,"常见的headless browsr有：",-1),F=e("ul",null,[e("li",null,"wkhtmlpdf ： Webkit implementation"),e("li",null,[t("headless chrome "),e("ul",null,[e("li",null,"Unlike wkhtmltopdf, it cares if you try to load an http resource inside an https page"),e("li",null,"JS engine cares about SOP(Same-Origin Policy)")])])],-1),R=e("p",null,[e("strong",null,"HTML Renderers")],-1),T=e("p",null,"不同于普通浏览器引擎，渲染器直接解析html和css来工作，不需要任何javascript",-1),H=e("p",null,"WeasyPrint is a great example of this class of HTML->PDF converters (more later)",-1),E=e("h3",{id:"构想",tabindex:"-1"},[t("构想： "),e("a",{class:"header-anchor",href:"#构想","aria-label":'Permalink to "构想："'},"​")],-1),x=e("p",null,[e("strong",null,"XSS → SSRF via wkhtmltopdf")],-1),D=e("p",null,"payload",-1),M=e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"iframe src=”http://169.254.169.254/user-data”"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])]),e("button",{class:"collapse"})],-1),C=e("p",null,[e("strong",null,"XSS via escaping style tag")],-1),j=e("p",null,"we are allowed to customize the fonts and styling of the generated PDF",-1),$=e("ul",null,[e("li",null,"Confirm it renders HTML within the PDF Generator"),e("li",null,"Can it fetch anything from a remote host”?")],-1),L=e("p",null,"payload like this",-1),A=e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"style><iframe src=”http://169.254.169.254/user-data”"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])]),e("button",{class:"collapse"})],-1),q=e("h3",{id:"根据pdf-generaterer-构造payload-之-weasyprint",tabindex:"-1"},[t("根据pdf generaterer 构造payload 之 WeasyPrint： "),e("a",{class:"header-anchor",href:"#根据pdf-generaterer-构造payload-之-weasyprint","aria-label":'Permalink to "根据pdf generaterer 构造payload 之 WeasyPrint："'},"​")],-1),J=e("p",null,"以上构想，weasyprint pdf生成器不会渲染iframe下的链接。weasyprint 仅支持渲染：",-1),I=e("ul",null,[e("li",null,"img"),e("li",null,"embed"),e("li",null,"object"),e("li",null,"link")],-1),V=e("p",null,"这里用link构造payload",-1),B=e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"link rel=attachment href=”file:///etc/passwd”"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])]),e("button",{class:"collapse"})],-1),O=e("h2",{id:"cve",tabindex:"-1"},[t("CVE "),e("a",{class:"header-anchor",href:"#cve","aria-label":'Permalink to "CVE"'},"​")],-1),N=e("ul",null,[e("li",null,[t("JIRA CVE-2017-9506 "),e("ul",null,[e("li",null,[e("s",null,"这个例子搜的话，有一篇对应的文章是将DOD（美国防部）下的三大主网之一的NIPRNet下出现的ssrf"),t(" 什么的我才不会说")])])])],-1),W=e("h2",{id:"how-to-prevent",tabindex:"-1"},[t("How to prevent "),e("a",{class:"header-anchor",href:"#how-to-prevent","aria-label":'Permalink to "How to prevent"'},"​")],-1),G=e("ul",null,[e("li",null,"Whitelisting"),e("li",null,[t("Blacklisting "),e("ul",null,[e("li",null,"如果内网地址加入了黑名单,可以用指向该内网地址的域名来跳过防御")])]),e("li",null,"Restricted Content-Type,extensions,or characters -Only allows a particular file type"),e("li",null,"No response")],-1),X=e("h2",{id:"ssrf-tools",tabindex:"-1"},[t("SSRF Tools "),e("a",{class:"header-anchor",href:"#ssrf-tools","aria-label":'Permalink to "SSRF Tools"'},"​")],-1),U=e("h3",{id:"httprebind",tabindex:"-1"},[t("HTTPRebind "),e("a",{class:"header-anchor",href:"#httprebind","aria-label":'Permalink to "HTTPRebind"'},"​")],-1),z=e("p",null,"Rebinding attacks can be very valuable for SSRF, but they require a lot of setup work, tweaking, and programming. HTTPRebind combines a DNS server with an HTTP server to automatically handle all of this for you.",-1),Z=e("ul",null,[e("li",null,"Usable against any headless browser"),e("li",null,"Takes only seconds to run due to DNS cache flushing"),e("li",null,"Automatically pulls critical data from GCP, AWS, and Azure")],-1),K=e("p",null,[t("Get the source at "),e("a",{href:"https://www.google.com/url?q=https://github.com/daeken/httprebind&sa=D&source=editors&ust=1669802685477614&usg=AOvVaw0ZOeVy2tBaGWcMI47AFqyE",target:"_blank",rel:"noreferrer"},"https://github.com/daeken/httprebind")],-1),Q=e("h3",{id:"ssrftest",tabindex:"-1"},[t("SSRFTest "),e("a",{class:"header-anchor",href:"#ssrftest","aria-label":'Permalink to "SSRFTest"'},"​")],-1),Y=e("p",null,"This tool lets you quickly do a first-pass test for SSRF. It will record incoming requests for your different targets as well as automatically attempt to access and dump data from EC2 metadata service.",-1),ee=e("p",null,"The optimal targets for SSRFTest’s automated functionality are real headless browsers living in the cloud, but it’s a useful starting point for any SSRF exploitation.",-1),te=e("p",null,[t("Get the code at "),e("a",{href:"https://www.google.com/url?q=https://github.com/daeken/SSRFTest&sa=D&source=editors&ust=1669802685480299&usg=AOvVaw36eed8jzuiS_G8FLPo1Ho5",target:"_blank",rel:"noreferrer"},"https://github.com/daeken/SSRFTest"),t(" or use the public instance at ["),e("a",{href:"https://ssrftest.com/",target:"_blank",rel:"noreferrer"},"https://ssrftest.com/")],-1),se=e("h2",{id:"reference",tabindex:"-1"},[t("Reference "),e("a",{class:"header-anchor",href:"#reference","aria-label":'Permalink to "Reference"'},"​")],-1),le=e("p",null,"Udemy",-1),ae=e("ul",null,[e("li",null,[e("a",{href:"https://www.udemy.com/course/intro-to-bug-bounty-by-nahamsec/learn/lecture/24998004#overview",target:"_blank",rel:"noreferrer"},"https://www.udemy.com/course/intro-to-bug-bounty-by-nahamsec/learn/lecture/24998004#overview")])],-1),re=e("p",null,"Medium",-1),ne=e("ul",null,[e("li",null,[e("a",{href:"https://vickieli.medium.com/bypassing-ssrf-protection-e111ae70727b",target:"_blank",rel:"noreferrer"},"https://vickieli.medium.com/bypassing-ssrf-protection-e111ae70727b")]),e("li",null,[e("a",{href:"https://infosecwriteups.com/piercing-the-veil-server-side-request-forgery-to-niprnet-access-c358fd5e249a",target:"_blank",rel:"noreferrer"},"https://infosecwriteups.com/piercing-the-veil-server-side-request-forgery-to-niprnet-access-c358fd5e249a")])],-1),oe=e("p",null,"PPT",-1),ie=e("ul",null,[e("li",null,[t("Google doc "),e("ul",null,[e("li",null,[t("["),e("a",{href:"https://docs.google.com/presentation/d/1JdIjHHPsFSgLbaJcHmMkE904jmwPM4xdhEuwhy2ebvo/htmlpresent",target:"_blank",rel:"noreferrer"},"https://docs.google.com/presentation/d/1JdIjHHPsFSgLbaJcHmMkE904jmwPM4xdhEuwhy2ebvo/htmlpresent")])])])],-1),_e={__name:"shen-ru-qian-chu-ssrfer-wo-de-xue-xi-bi-ji",setup(he,{expose:h}){const r=JSON.parse('{"title":"深入浅出SSRF（二）：我的学习笔记","description":"","frontmatter":{"title":"深入浅出SSRF（二）：我的学习笔记","date":"2022-11-30T23:22:46.000Z","tags":["SSRF","笔记"],"published":true,"hideInList":false,"feature":null,"isTop":false},"headers":[{"level":2,"title":"XSS+PDF==SSRF","slug":"xss-pdf-ssrf","link":"#xss-pdf-ssrf","children":[{"level":3,"title":"Headless Browsers & HTML Renderers","slug":"headless-browsers-html-renderers","link":"#headless-browsers-html-renderers","children":[]},{"level":3,"title":"构想：","slug":"构想","link":"#构想","children":[]},{"level":3,"title":"根据pdf generaterer 构造payload 之 WeasyPrint：","slug":"根据pdf-generaterer-构造payload-之-weasyprint","link":"#根据pdf-generaterer-构造payload-之-weasyprint","children":[]}]},{"level":2,"title":"CVE","slug":"cve","link":"#cve","children":[]},{"level":2,"title":"How to prevent","slug":"how-to-prevent","link":"#how-to-prevent","children":[]},{"level":2,"title":"SSRF Tools","slug":"ssrf-tools","link":"#ssrf-tools","children":[{"level":3,"title":"HTTPRebind","slug":"httprebind","link":"#httprebind","children":[]},{"level":3,"title":"SSRFTest","slug":"ssrftest","link":"#ssrftest","children":[]}]},{"level":2,"title":"Reference","slug":"reference","link":"#reference","children":[]}],"relativePath":"pages/posts/history/shen-ru-qian-chu-ssrfer-wo-de-xue-xi-bi-ji.md","path":"/home/runner/work/1dayluo.github.io/1dayluo.github.io/pages/posts/history/shen-ru-qian-chu-ssrfer-wo-de-xue-xi-bi-ji.md","lastUpdated":1714218709000}'),o=u(),n=r.frontmatter||{};return o.meta.frontmatter=Object.assign(o.meta.frontmatter||{},r.frontmatter||{}),i("pageData",r),i("valaxy:frontmatter",n),globalThis.$frontmatter=n,h({frontmatter:{title:"深入浅出SSRF（二）：我的学习笔记",date:"2022-11-30T23:22:46.000Z",tags:["SSRF","笔记"],published:!0,hideInList:!1,feature:null,isTop:!1}}),(l,ce)=>{const d=c;return p(),m(d,{frontmatter:f(n)},{"main-content-md":s(()=>[g,b,_,k,y,w,v,S,P,F,R,T,H,E,x,D,M,C,j,$,L,A,q,J,I,V,B,O,N,W,G,X,U,z,Z,K,Q,Y,ee,te,se,le,ae,re,ne,oe,ie]),"main-header":s(()=>[a(l.$slots,"main-header")]),"main-header-after":s(()=>[a(l.$slots,"main-header-after")]),"main-nav":s(()=>[a(l.$slots,"main-nav")]),"main-content":s(()=>[a(l.$slots,"main-content")]),"main-content-after":s(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":s(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":s(()=>[a(l.$slots,"main-nav-after")]),comment:s(()=>[a(l.$slots,"comment")]),footer:s(()=>[a(l.$slots,"footer")]),aside:s(()=>[a(l.$slots,"aside")]),"aside-custom":s(()=>[a(l.$slots,"aside-custom")]),default:s(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{_e as default};
