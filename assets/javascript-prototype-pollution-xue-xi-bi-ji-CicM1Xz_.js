import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-DRVqeRiY.js";import{a as d,p as r,o as c,c as E,w as t,f as g,r as l,g as i,h as s}from"./app-CzjF7NIc.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-17i98rOK.js";import"./YunCard.vue_vue_type_script_setup_true_lang-Da3dkqK-.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-BsneHNVS.js";import"./index-C7yU5XnD.js";const u=i("p",null,"笔记中英文混杂,问就是懒得翻译.学习笔记都是二次吸收,原始文章见Resource&Reference处. 笔记只是留给自己学习反复查阅和理解的…尽可能写的对自己来说全面一些.",-1),y=i("p",null,[i("s",null,"其实学了也还不会找gadget,我都想要不要去学下前端开发了_(:3_|/_)"),s(" 今天也是被自己菜到抑郁的一天呢!")],-1),_=i("h2",{id:"intro",tabindex:"-1"},[s("Intro "),i("a",{class:"header-anchor",href:"#intro","aria-label":'Permalink to "Intro"'},"​")],-1),b=i("p",null,"Prototype Pollution is a vulnerability that allows attackers to exploit the rules of the JavaScript programming language, by injecting properties into existing JavaScript language construct prototypes",-1),m=i("p",null,[s("：Properties on the "),i("code",null,"Object.prototype"),s(" are then inherited by all the JavaScript objects through the prototype chain")],-1),F=i("ul",null,[i("li",null,[s("JavaScript allows all Object attributes to be altered，This includes their magical attributes such as "),i("code",null,"__**proto__"),s("** , "),i("code",null,"constructor"),s(" and "),i("code",null,"prototype")])],-1),f=i("h3",{id:"impact",tabindex:"-1"},[s("impact "),i("a",{class:"header-anchor",href:"#impact","aria-label":'Permalink to "impact"'},"​")],-1),v=i("ul",null,[i("li",null,"Denial of Service: by triggering JavaScript exceptions"),i("li",null,"RCE: by tampering with the application source code to force the code path that the attacker injects"),i("li",null,"XSS:")],-1),C=i("h2",{id:"base-knowledege",tabindex:"-1"},[s("Base Knowledege "),i("a",{class:"header-anchor",href:"#base-knowledege","aria-label":'Permalink to "Base Knowledege"'},"​")],-1),j=i("h3",{id:"理解object",tabindex:"-1"},[i("strong",null,"理解object"),s(),i("a",{class:"header-anchor",href:"#理解object","aria-label":'Permalink to "**理解object**"'},"​")],-1),A=i("p",null,"最简单的object：",-1),D=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," obj "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {};")])])]),i("button",{class:"collapse"})],-1),w=i("p",null,[s("该object有一些 "),i("code",null,"property"),s(" :")],-1),B=i("ul",null,[i("li",null,[i("code",null,"obj.__proto__")]),i("li",null,[i("code",null,"obj.constructor")]),i("li",null,[i("code",null,"obj.toString")]),i("li",null,"….")],-1),x=i("p",null,"In JavaScript, functions can be treated like normal variablesIn JavaScript, functions can be treated like normal variables",-1),S=i("p",null,"so object methods are definede as properties, like this:",-1),P=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {name: "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Ivan'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", surname: "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Ivanov'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"o."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"foo"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"foobar"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),O=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"foo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"< "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"foobar")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-dark":"#FDAEB7","--shiki-light-font-style":"italic","--shiki-dark-font-style":"italic"}},"<"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," undefined")])])]),i("button",{class:"collapse"})],-1),N=i("p",null,"进一步理解：",-1),R=i("p",null,"The concept of a class in JavaScript starts with a function. The function itself serves as the constructor of the class",-1),J=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MyClass"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," inst "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MyClass"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),i("button",{class:"collapse"})],-1),T=i("p",null,"这里Function被所有在原型（proptotype)上声明的“MyClass”实例所使用，且原型在运行时被修改。这意味着任何时候都能够修改一个class的prototype（增加，修改，删除）",-1),I=i("p",null,[s("回头看最开始的（最简单的object），可以理解为该object的构造函数其实是 "),i("code",null,"Object"),s(" ，而例如 "),i("code",null,"toString"),s(" 则是 "),i("code",null,"Object"),s(" 上的prototype。")],-1),q=i("h3",{id:"property-access",tabindex:"-1"},[s("Property access "),i("a",{class:"header-anchor",href:"#property-access","aria-label":'Permalink to "Property access"'},"​")],-1),V=i("aside",null," 💡 What’s good to note is that in JavaScript there is no distinction between a property and an instance function ",-1),L=i("p",null,[s("获取property的方法参考:"),i("a",{href:"https://www.notion.so/Javascript-Prototype-Pollution-232f17fb812543ff9749b1257cee191e",target:"_blank",rel:"noreferrer"},"https://www.notion.so/Javascript-Prototype-Pollution-232f17fb812543ff9749b1257cee191e#6856032c4ccf42368be8f7e3e9447c4c")],-1),U=i("ul",null,[i("li",null,"obj.name"),i("li",null,"obj[”name”]")],-1),M=i("h3",{id:"object-prototype",tabindex:"-1"},[s("Object prototype "),i("a",{class:"header-anchor",href:"#object-prototype","aria-label":'Permalink to "Object prototype"'},"​")],-1),W=i("p",null,[s("Let’s call "),i("code",null,"toString()"),s(" method")],-1),z=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toString"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "[object Object]"')])])]),i("button",{class:"collapse"})],-1),G=i("aside",null," 💡 check the prototype of object o,call use Object.getOwnPropertyNames() ",-1),H=i("p",null,[i("strong",null,[s("Where did the "),i("code",null,"tostring"),s(" method come from?")])],-1),$=i("p",null,"Almost any entity is an object that includes arrays, functions, and even class definition!",-1),Q=i("p",null,[i("strong",null,"property"),s(" "),i("code",null,"[[Prototype]]")],-1),X=i("p",null,[s("How can you use them to implement such a convenient feature of the classes as inheritance? You can select a special property that each object will have. It will contain a reference to the parent. Let’s call this property "),i("code",null,"[[Prototype]]")],-1),K=i("p",null,[s("what if we don’t want to inherit all the properties and methods from the parent,Let’s select a special property from the parent from which the properties and methods will be inherited and call it "),i("code",null,"prototype"),s("!")],-1),Y=i("p",null,[s("When you access an object property via "),i("a",{href:"http://o.name/",target:"_blank",rel:"noreferrer"},"o.name"),s(" or o['name'] actually does the following:")],-1),Z=i("ol",null,[i("li",null,[s("The JavaScript engine searches for the "),i("code",null,"name"),s(" property in the "),i("code",null,"o"),s(" object.")]),i("li",null,[s("If the property is present, it is returned. Otherwise, the prototype of the "),i("code",null,"o"),s(" object is taken and the property is searched for in it!")])],-1),ii=i("p",null,[s("So it turns out that the "),i("code",null,"toString()"),s(" method is actually defined in "),i("code",null,"Object.prototype")],-1),si=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"constructor"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ƒ, "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__defineGetter__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ƒ, "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__defineSetter__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ƒ, "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hasOwnProperty"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ƒ, "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__lookupGetter__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ƒ, …}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"< "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"null")])])]),i("button",{class:"collapse"})],-1),ti=i("p",null,"一直到null的这条prototypes的链条称为原型链",-1),ei=i("p",null,"📢 By the way, the word “prototype” in JavaScript can refer to at least three different things, depending on the context:",-1),li=i("ul",null,[i("li",null,[s('Internal property [[Prototype]]. It is called internal because it lives in the "guts" of the JavaScript engine, we only get access to it through the special functions '),i("strong",null,"proto"),s(", Object.getPrototypeOf(), and others.")]),i("li",null,"The prototype property: Object.prototype, Function.prototype, and others."),i("li",null,[s("The "),i("strong",null,"proto"),s(" property. A rare and not quite correct use, because technically "),i("strong",null,"proto"),s(" is a getter / setter and only gets a reference to the prototype of the object and returns it.")])],-1),ai=i("h3",{id:"proto-和-prototype的区别",tabindex:"-1"},[i("code",null,"__proto__"),s(" 和 prototype的区别 "),i("a",{class:"header-anchor",href:"#proto-和-prototype的区别","aria-label":'Permalink to "`__proto__` 和 prototype的区别"'},"​")],-1),ni=i("p",null,[s("首先 "),i("code",null,"class"),s(" 是语法糖,")],-1),hi=i("p",null,[i("code",null,"prototype"),s(" (原型)用于声明类时,创建类下的方法(不然会新建对象,其下的方法就会执行一次),"),i("strong",null,[s("可以认为prototype是类 "),i("code",null,"Foo"),s(" 的一个属性.")])],-1),ri=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Foo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".bar "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Foo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"prototype"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"show"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," show"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".bar)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," foo "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Foo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"foo."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"show"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")])])]),i("button",{class:"collapse"})],-1),oi=i("p",null,"类对象在实例化的时候,会拥有prototype中哦你感动属性和方法",-1),ki=i("p",null,[i("code",null,"__proto__"),s(" 用于访问原型(prototype), 即")],-1),pi=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"foo."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," Foo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"prototype")])])]),i("button",{class:"collapse"})],-1),di=i("h3",{id:"原型链继承",tabindex:"-1"},[s("原型链继承 "),i("a",{class:"header-anchor",href:"#原型链继承","aria-label":'Permalink to "原型链继承"'},"​")],-1),ci=i("p",null,"原型链的查找发生在对象上.",-1),Ei=i("ol",null,[i("li",null,"每个构造函数(constructor)都有一个原型对象(prototype)"),i("li",null,[s("对象的"),i("code",null,"__proto__"),s("属性，指向类的原型对象"),i("code",null,"prototype")]),i("li",null,"JavaScript使用prototype链实现继承机制")],-1),gi=i("h2",{id:"what-is-prototype-pollution",tabindex:"-1"},[s("What is prototype pollution? "),i("a",{class:"header-anchor",href:"#what-is-prototype-pollution","aria-label":'Permalink to "What is prototype pollution?"'},"​")],-1),ui=i("blockquote",null,[i("p",null,[s("The term prototype pollution refers to the situation when the "),i("code",null,"prototype"),s("  property of "),i("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects#fundamental_objects",target:"_blank",rel:"noreferrer"},"fundamental objects"),s("  is changed.")])],-1),yi=i("p",null,"what prototype pollution look like in the code",-1),_i=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {};")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," process.argv["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"];")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'test'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," process.argv["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"];")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(({}).test);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"o[a][b] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(({}).test);")])])]),i("button",{class:"collapse"})],-1),bi=i("p",null,[s("attacker controls the parameters "),i("code",null,"a"),s(" and "),i("code",null,"v"),s(" ,they can:")],-1),mi=i("ul",null,[i("li",null,[i("code",null,"v = __proto__")])],-1),Fi=i("h2",{id:"base-sample",tabindex:"-1"},[s("base sample: "),i("a",{class:"header-anchor",href:"#base-sample","aria-label":'Permalink to "base sample:"'},"​")],-1),fi=i("p",null,"sample 1:",-1),vi=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," someObject "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," user "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"assert"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(user.isAdmin "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"==="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Rerturn:Assertion failed")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"someObject."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".isAdmin "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"assert"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(user.isAdmin "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"==="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Return:udefined")])])]),i("button",{class:"collapse"})],-1),Ci=i("p",null,"sample 2",-1),ji=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// foo是一个简单的JavaScript对象")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," foo "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {bar: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// foo.bar 此时为1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(foo.bar)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 修改foo的原型（即Object）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"foo."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".bar "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 由于查找顺序的原因，foo.bar仍然是1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(foo.bar)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 此时再用Object创建一个空的zoo对象")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," zoo "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 查看zoo.bar")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(zoo.bar)")])])]),i("button",{class:"collapse"})],-1),Ai=i("p",null,"sample3",-1),Di=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o1 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o2 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," JSON"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"parse"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`'{"a": 1, "__proto__": {"b": 2}}'`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"merge"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(o1, o2)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(o1.a, o1.b)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"o3 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(o3.b)")])])]),i("button",{class:"collapse"})],-1),wi=i("p",null,[s("JSON解析的情况下，"),i("code",null,"__proto__"),s(" 会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。")],-1),Bi=i("h2",{id:"detection",tabindex:"-1"},[s("Detection "),i("a",{class:"header-anchor",href:"#detection","aria-label":'Permalink to "Detection"'},"​")],-1),xi=i("p",null,[s("该节参考:"),i("a",{href:"https://blog.s1r1us.ninja/research/PP",target:"_blank",rel:"noreferrer"},"https://blog.s1r1us.ninja/research/PP")],-1),Si=i("h3",{id:"case-1",tabindex:"-1"},[s("Case 1 "),i("a",{class:"header-anchor",href:"#case-1","aria-label":'Permalink to "Case 1"'},"​")],-1),Pi=i("p",null,[s("检查 "),i("code",null,"query/hash")],-1),Oi=i("p",null,[s("该例子使用了"),i("a",{href:"https://www.google.com/url?q=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcan-deparam&sa=D&sntz=1&usg=AOvVaw220_I7_8edi7_BK19uQKBF",target:"_blank",rel:"noreferrer"},"canjs-deparam"),s(" 库去解析query参数")],-1),Ni=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"keyBreaker "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#DBEDFF"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"["),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"^"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D","--shiki-light-font-weight":"bold","--shiki-dark-font-weight":"bold"}},"\\[\\]"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#DBEDFF"}},")"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#DBEDFF"}},"("),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D","--shiki-light-font-weight":"bold","--shiki-dark-font-weight":"bold"}},"\\[\\]"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#DBEDFF"}},")"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"g"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"...")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"module"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"exports"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," namespace."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"deparam"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"params"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"valueDeserializer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    valueDeserializer "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," valueDeserializer "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," idenity;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," data "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {}, pairs, lastPart;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (params "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," paramTest."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"test"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(params)) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        pairs "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," params."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"split"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'&'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        pairs."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"pair"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," pair."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"split"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'='"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                key "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," prep"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(parts."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"shift"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()),")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," prep"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(parts."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'='"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")),")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                current "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," data;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (key) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                parts "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(keyBreaker);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," j "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", l "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"length"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; j "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," l; j"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," currentName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts[j],")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        nextName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts[j "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"],")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        currentIsArray "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," isArrayLikeName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(currentName) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," current "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Array"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"current[currentName]) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(currentIsArray) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            current."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"push"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"( "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isArrayLikeName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(nextName) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {} );")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // If what we are pointing to looks like an `array`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            current[currentName] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," isArrayLikeName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(nextName) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {};")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(currentIsArray) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        current "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," current[current."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"length"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"];")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        current "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," current[currentName];")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                lastPart "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pop"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ( "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isArrayLikeName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(lastPart) ) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    current."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"push"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"valueDeserializer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(value));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    current[lastPart] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," valueDeserializer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(value);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," data;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}; ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," obj "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," deparam"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(location.hash."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"substr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")])])]),i("button",{class:"collapse"})],-1),Ri=i("p",null,[s("例如上面的例子,检测是否存在原型链污染解析的方式是遍历不同的原型链污染payload在 "),i("code",null,"location.hash"),s(" 和 "),i("code",null,"location.search"),s(" 中:")],-1),Ji=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"x[__proto__][abaeead] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," abaeead")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"x."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".edcbcab "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," edcbcab")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"__proto__[eedffcb] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," eedffcb")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"__proto__.baaebfc "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," baaebfc")])])]),i("button",{class:"collapse"})],-1),Ti=i("h3",{id:"case-2",tabindex:"-1"},[s("Case 2 "),i("a",{class:"header-anchor",href:"#case-2","aria-label":'Permalink to "Case 2"'},"​")],-1),Ii=i("p",null,[s("这个例子里,我们检查一些位于客户端的"),i("strong",null,"用户输入"),s("或一些"),i("strong",null,"data/response处理"),s("的功能,会导致原型链污染.大部分时候,这个将导致self-XSS,这是因为攻击者无法控制例如case1的来自于location的输入,但,大部分时候,self-XSS能转换为reflected XSS")],-1),qi=i("p",null,"这部分自动化使用CodeQL,需要下载全部的javascript,然后创建CodeQL数据库并扫描是否有js会导致prototype pollution",-1),Vi=i("h3",{id:"property-definition-by-path-location",tabindex:"-1"},[i("strong",null,[i("strong",null,"Property definition by path/location")]),s(),i("a",{class:"header-anchor",href:"#property-definition-by-path-location","aria-label":'Permalink to "****Property definition by path/location****"'},"​")],-1),Li=i("aside",null," 💡 There are numerous JavaScript libraries which are vulnerable to Prototype Pollution due to *`document.location`* ",-1),Ui=i("p",null,[s("Prototype pollution list："),i("a",{href:"https://github.com/BlackFan/client-side-prototype-pollution",target:"_blank",rel:"noreferrer"},"https://github.com/BlackFan/client-side-prototype-pollution")],-1),Mi=i("ul",null,[i("li",null,[s("see al available properties of the Object: "),i("code",null,"Object.prototyp")])],-1),Wi=i("p",null,"you can pollute：",-1),zi=i("ul",null,[i("li",null,[s("polluting all the object with the new attribute (reference "),i("a",{href:"https://www.notion.so/JSON-__proto__-o2-a379ece6dec24bdd87fe60bc39932a04",target:"_blank",rel:"noreferrer"},[s("JSON解析的情况下，"),i("code",null,"__proto__"),s(" 会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。")]),s(" ）")]),i("li",null,[s("polluting the DOM （reference "),i("a",{href:"https://www.notion.so/e19fee3d65fb47309c476cb7e103536b",target:"_blank",rel:"noreferrer"}),s(" )")])],-1),Gi=i("p",null,[i("strong",null,"unsafe merge recurses")],-1),Hi=i("p",null,[i("code",null,"lodash"),s("and "),i("code",null,"Hoek"),s(" are examples of libraries susceptible to recursive merge attacks.")],-1),$i=i("p",null,"简述原型污染下merge recurses步骤：",-1),Qi=i("ul",null,[i("li",null,[s("检查源代码是否包含 "),i("code",null,"__proto__"),s(" 属性（被 "),i("code",null,"Object.definProperty()"),s(" 命名的），属性存在且一个object既在目标也在源代码中,且在目标上合并递归")]),i("li",null,[s("攻击者定义 "),i("code",null,"Object"),s(" 来源，将properties复制到 "),i("code",null,"Object"),s(" 的prototype上")])],-1),Xi=i("aside",null," 💡 Clone operations是unsafe recursive merges的一个特殊子类：发生在recursive merges的对象是空的Object. `merge({},source)` ",-1),Ki=i("p",null,[i("strong",null,"Example 1")],-1),Yi=i("aside",null," 💡 The impact and severity of Prototype Pollution depends on the application. Property definition by path/location is a key example. ",-1),Zi=i("p",null,"we create object Book as：",-1),is=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," book "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {bookName: "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Book name"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", authorName: "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Author of book"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")])])]),i("button",{class:"collapse"})],-1),ss=i("p",null,[s("we can use "),i("code",null,"book.bookName"),s(" or "),i("code",null,'book["bookName"]'),s(" to get the book’s name")],-1),ts=i("ul",null,[i("li",null,[i("p",null,"not work:"),i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"book."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"constructor"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".protoSomeRandomName "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// this will not work, since there is no attribute protoSomeRandomName*")])])]),i("button",{class:"collapse"})])]),i("li",null,[i("p",null,"work:"),i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Object."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomName"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomValue"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"book."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"constructor"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".protoSomeRandomName "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// this will work and return value protoSomeRandomValue")])])]),i("button",{class:"collapse"})]),i("ul",null,[i("li",null,"We proved this indeed polluted all the objects created from the object Object with the new attribute,and all of these new objects have inherited this attribute from the prototype.")])]),i("li",null,[i("p",null,"other ways:"),i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Object."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomName"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomValue"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Object."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__proto__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".protoSomeRandomName"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomValue"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Object."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"constructor"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"prototype"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".protoSomeRandomName"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomValue"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Object."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"constructor"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"prototype"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomName"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"protoSomeRandomValue"')])])]),i("button",{class:"collapse"})])])],-1),es=i("h3",{id:"vulnerable-document-location-parsers",tabindex:"-1"},[s("**"),i("strong",null,[s("vulnerable "),i("em",null,"document.location"),s(" parsers")]),s(),i("a",{class:"header-anchor",href:"#vulnerable-document-location-parsers","aria-label":'Permalink to "****vulnerable *document.location* parsers**"'},"​")],-1),ls=i("p",null,[i("em",null,[s("Credits go to: "),i("a",{href:"https://github.com/msrkp",target:"_blank",rel:"noreferrer"},"s1r1us")])],-1),as=i("p",null,"有关的文章:",-1),ns=i("ul",null,[i("li",null,[i("a",{href:"https://blog.s1r1us.ninja/research/PP",target:"_blank",rel:"noreferrer"},"https://blog.s1r1us.ninja/research/PP")])],-1),hs=i("p",null,"相关学习笔记",-1),rs=i("p",null,[i("a",{href:"https://www.notion.so/document-location-c10ca99b748145849ac793d1ff47ce0e",target:"_blank",rel:"noreferrer"},[i("em",null,[i("strong",null,[i("strong",null,"document.location 靶场练习笔记")])])])],-1),os=i("p",null,[i("strong",null,[s("Example 1 : "),i("code",null,"jquery-deparam"),s(".")])],-1),ks=i("p",null,[i("a",{href:"https://msrkp.github.io/pp/1.html?__proto__%5BprotoSomeRandomName%5D=protoSomeRandomValue",target:"_blank",rel:"noreferrer"},[s("https://msrkp.github.io/pp/1.html?"),i("strong",null,"proto"),s("[protoSomeRandomName]=protoSomeRandomValue")])],-1),ps=i("p",null,[s("related : "),i("a",{href:"https://security.snyk.io/vuln/SNYK-JS-JQUERYDEPARAM-1255651",target:"_blank",rel:"noreferrer"},"https://security.snyk.io/vuln/SNYK-JS-JQUERYDEPARAM-1255651")],-1),ds=i("p",null,[i("strong",null,"Example 2")],-1),cs=i("p",null,[i("a",{href:"https://msrkp.github.io/pp/2.html?__proto__%5BprotoSomeRandomName%5D=protoSomeRandomValue",target:"_blank",rel:"noreferrer"},[s("https://msrkp.github.io/pp/2.html?"),i("strong",null,"proto"),s("[protoSomeRandomName]=protoSomeRandomValue")])],-1),Es=i("p",null,[i("strong",null,"Example 3")],-1),gs=i("p",null,[i("a",{href:"https://msrkp.github.io/pp/3.html?__proto__%5BprotoSomeRandomName%5D=protoSomeRandomValue",target:"_blank",rel:"noreferrer"},[s("https://msrkp.github.io/pp/3.html?"),i("strong",null,"proto"),s("[protoSomeRandomName]=protoSomeRandomValue")])],-1),us=i("h2",{id:"identifying-the-vulnerable-library",tabindex:"-1"},[s("Identifying the vulnerable library "),i("a",{class:"header-anchor",href:"#identifying-the-vulnerable-library","aria-label":'Permalink to "Identifying the vulnerable library"'},"​")],-1),ys=i("p",null,"我们下一步需要:",-1),_s=i("ul",null,[i("li",null,"识别存在漏洞的library"),i("li",null,"明确具体那一行原型链被污染"),i("li",null,"哪些污染结果存储在了数据库中")],-1),bs=i("p",null,[s("如果application不复杂,可以使用以下关键词: "),i("code",null,"location.hash/decodeURIComponent/location.search")],-1),ms=i("h3",{id:"blocking-the-js-resource-request-in-firefox",tabindex:"-1"},[s("Blocking the JS resource request in Firefox "),i("a",{class:"header-anchor",href:"#blocking-the-js-resource-request-in-firefox","aria-label":'Permalink to "Blocking the JS resource request in Firefox"'},"​")],-1),Fs=i("figure",null,[i("img",{src:"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled.png20220526_a.png",alt:"Untitled",loading:"lazy",decoding:"async"})],-1),fs=i("p",null,[s("为了确认对应的js源文件是否导致了原型链污染.我们可以block url ,然后确认被污染的property是否为 "),i("code",null,"undefined"),s(" ,如果是,则确认该js源文件导致了原型链污染")],-1),vs=i("h3",{id:"debugger-breakpoint-on-setter",tabindex:"-1"},[s("Debugger Breakpoint on setter "),i("a",{class:"header-anchor",href:"#debugger-breakpoint-on-setter","aria-label":'Permalink to "Debugger Breakpoint on setter"'},"​")],-1),Cs=i("p",null,"This technique is easier than others, we can set a breakpoint when the property is set to Obect.prototype.",-1),js=i("p",null,[s("![Untitled]("),i("a",{href:"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled",target:"_blank",rel:"noreferrer"},"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled"),s(" 1.png20220526_a.png)")],-1),As=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," breakpoint"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"obj"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"prop"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"	var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tmp "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," obj[prop];")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       Object."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"defineProperty"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(obj, prop, {")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"           set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"val"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"               debugger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"               return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tmp "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," val;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       });")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"   };")])])]),i("button",{class:"collapse"})],-1),Ds=i("h3",{id:"sensitive-function",tabindex:"-1"},[s("sensitive function "),i("a",{class:"header-anchor",href:"#sensitive-function","aria-label":'Permalink to "sensitive function"'},"​")],-1),ws=i("p",null,"javascript:",-1),Bs=i("ul",null,[i("li",null,[i("code",null,"Object.assign")])],-1),xs=i("p",null,"npmjs/jquery",-1),Ss=i("ul",null,[i("li",null,[i("code",null,"canjs-deparam"),s(" - deparam")])],-1),Ps=i("h2",{id:"finding-script-gadgets",tabindex:"-1"},[s("Finding Script Gadgets "),i("a",{class:"header-anchor",href:"#finding-script-gadgets","aria-label":'Permalink to "Finding Script Gadgets"'},"​")],-1),Os=i("h3",{id:"what-is-a-script-gadget",tabindex:"-1"},[s("What is a script gadget? "),i("a",{class:"header-anchor",href:"#what-is-a-script-gadget","aria-label":'Permalink to "What is a script gadget?"'},"​")],-1),Ns=i("p",null,"定义",-1),Rs=i("p",null,"On the client-side, the escalation to XSS is the most interesting. The JavaScript code that can be used to escalate prototype pollution to other vulnerability is called a gadget.",-1),Js=i("p",null,"在确认了property被污染后, 是否有application logic或功能点能导致javascript execution.",-1),Ts=i("p",null,"这里举的例子是SwiftType Search library中的script gadget,该payload会导致XSS:",-1),Is=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"https"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//example.com/#__proto__[xxx]=alert(1)")])])]),i("button",{class:"collapse"})],-1),qs=i("p",null,[s("以下是导致产生alert的代码片段(script gadget), "),i("code",null,"$.each"),s(" 遍历 "),i("code",null,"this._userServerConfiguration.install.hooks"),s(" 对象以及位于原型(prototype)上的属性,这将导致我们污染的原型 "),i("code",null,"xxx"),s(" 被执行")],-1),Vs=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"each"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"t"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"i"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"   /*removed for brevity*/")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"         for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (o "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"in"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"             if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (r "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"call"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(t[o], o, t[o]),")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"             r "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"==="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                 break"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"pInstall."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"_convertStringHooksToFunctions"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"   var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," functionHooks "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {};")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"   $."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"each"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"._userServerConfiguration.install.hooks, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"hookName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"hookFunction"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       functionHooks[hookName] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," eval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(hookFunction)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"   }),")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   this"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"._userServerConfiguration.install.hooks "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," functionHooks")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),Ls=i("h3",{id:"using-existing-gadgets",tabindex:"-1"},[s("using existing gadgets "),i("a",{class:"header-anchor",href:"#using-existing-gadgets","aria-label":'Permalink to "using existing gadgets"'},"​")],-1),Us=i("p",null,[s("First of all, it makes sense to check the existing gadgets in the "),i("a",{href:"https://github.com/BlackFan/client-side-prototype-pollution",target:"_blank",rel:"noreferrer"},"BlackFan/client-side-prototype-pollution"),s(" repository or in the "),i("a",{href:"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution",target:"_blank",rel:"noreferrer"},"Cross-site scripting (XSS) cheat sheet.")],-1),Ms=i("ul",null,[i("li",null,[s("Using the "),i("a",{href:"https://chrome.google.com/webstore/detail/wappalyzer/gppongmhjkpfnbhagpmjfkannfbllamg?hl=en",target:"_blank",rel:"noreferrer"},"Wappalyzer"),s(" plugin.")]),i("li",null,[s("Using a script "),i("a",{href:"https://gist.github.com/nikitastupin/b3b64a9f8c0eb74ce37626860193eaec",target:"_blank",rel:"noreferrer"},"fingerprint.js"),s(".")])],-1),Ws=i("p",null,"fingerprint.js使用方式:",-1),zs=i("ul",null,[i("li",null,[i("p",null,"Copy the script and execute it in the context of the vulnerable page."),i("p",null,[s("![Untitled]("),i("a",{href:"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled",target:"_blank",rel:"noreferrer"},"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled"),s(" 2.png20220526_a.png)")]),i("ul",null,[i("li",null,[i("em",null,[i("a",{href:"https://gist.github.com/nikitastupin/b3b64a9f8c0eb74ce37626860193eaec",target:"_blank",rel:"noreferrer"},"fingerprint.js"),s(" shows that the page has a Twitter Universal Website Tag gadget")])])])]),i("li",null,[i("p",null,[s("去"),i("a",{href:"https://github.com/BlackFan/client-side-prototype-pollution",target:"_blank",rel:"noreferrer"},"https://github.com/BlackFan/client-side-prototype-pollution"),s(" 搜关键词”Universal Website Tag” 发现已知gadget")])]),i("li",null,[i("p",null,[s("找到后测试:we are interested in the "),i("a",{href:"https://github.com/BlackFan/client-side-prototype-pollution/blob/004bf5353f6f30b720f3d68c5aca5191531f35d6/gadgets/twitter-uwt.md#poc",target:"_blank",rel:"noreferrer"},"PoC"),s(" section with a ready-made payload. Trying out a payload on a vulnerable site "),i("code",null,"[https://ctf.nikitastupin.com/pp/known.html?__proto__[hif][]=javascript:alert(document.domain)](https://ctf.nikitastupin.com/pp/known.html?__proto__[hif][]=javascript:alert(document.domain).)")])])],-1),Gs=i("h3",{id:"👏-finding-new-gadgets",tabindex:"-1"},[s("👏 Finding new gadgets "),i("a",{class:"header-anchor",href:"#👏-finding-new-gadgets","aria-label":'Permalink to "👏 Finding new gadgets"'},"​")],-1),Hs=i("p",null,[s("like this: "),i("code",null,"[https://ctf.nikitastupin.com/pp/unknown.html?__proto__[polluted]=31337](https://ctf.nikitastupin.com/pp/unknown.html?__proto__[polluted]=31337.)")],-1),$s=i("p",null,"Despite the fact that Wappalyzer reports the presence of jQuery,this is a false positive due to the jquery-deparam library that is used on the site",-1),Qs=i("p",null,"There are several approaches to finding new gadgets:",-1),Xs=i("ol",null,[i("li",null,[i("a",{href:"https://github.com/filedescriptor/untrusted-types/tree/old",target:"_blank",rel:"noreferrer"},"filedescriptor/untrusted-types"),s(". At the time of writing, there are two versions of the plugin: "),i("code",null,"main"),s(" and "),i("code",null,"old"),s(". We will use "),i("code",null,"old"),s(" because it is simpler than "),i("code",null,"main"),s(". This plugin was originally developed for DOM XSS search, details can be found in the video "),i("a",{href:"https://youtu.be/CNNCCgDkt5k",target:"_blank",rel:"noreferrer"},"Finding DOMXSS with DevTools | Untrusted Types Chrome Extension"),s(".")]),i("li",null,[i("a",{href:"https://github.com/securitum/research/tree/master/r2020_prototype-pollution",target:"_blank",rel:"noreferrer"},"pollute.js"),s(". How this tool works, as well as what vulnerabilities it allowed you to find, can be read in the article "),i("a",{href:"https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/",target:"_blank",rel:"noreferrer"},"Prototype pollution — and bypassing client-side HTML sanitizers"),s(".")]),i("li",null,"Search with your hands, using the debugger.")],-1),Ks=i("p",null,[s("案例请看"),i("a",{href:"https://infosecwriteups.com/javascript-prototype-pollution-practice-of-finding-and-exploitation-f97284333b2",target:"_blank",rel:"noreferrer"},"https://infosecwriteups.com/javascript-prototype-pollution-practice-of-finding-and-exploitation-f97284333b2"),s(" 下的Edge case 接近于现实的案例.非常精彩的分析过程")],-1),Ys=i("h3",{id:"keyword-search-and-source-code-review",tabindex:"-1"},[s("Keyword search and Source Code Review "),i("a",{class:"header-anchor",href:"#keyword-search-and-source-code-review","aria-label":'Permalink to "Keyword search and Source Code Review"'},"​")],-1),Zs=i("p",null,"if application is simple,we can search for keywords like:",-1),it=i("ul",null,[i("li",null,[i("code",null,"srcdoc")]),i("li",null,[i("code",null,"innerHTML")]),i("li",null,[i("code",null,"iframe")]),i("li",null,[i("code",null,"crateElement")])],-1),st=i("p",null,"review the source code and check if it leads to javascript execution.",-1),tt=i("p",null,"Sometimes, mentioned techniques might not find gadgets at all.",-1),et=i("p",null,"In that case, pure source code review reveals some nice gadgets like the below example.",-1),lt=i("h3",{id:"jquery-example",tabindex:"-1"},[s("jQuery example "),i("a",{class:"header-anchor",href:"#jquery-example","aria-label":'Permalink to "jQuery example"'},"​")],-1),at=i("p",null,"BlackFan found this cool gadget in jQuery with source code review.",-1),nt=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"script"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"src"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"https"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//code.jquery.com/jquery-3.3.1.js><\/script>")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"script"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object.prototype.preventDefault='x'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object.prototype.handleObj='x'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object.prototype.delegateTarget='<img/src/onerror=alert(1)>'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," /* No extra code needed for jQuery 1 & 2 */")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $(document).off('foobar');")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"script"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),i("button",{class:"collapse"})],-1),ht=i("p",null,"Here is the piece of code which is responsible for the gadget which is self explanatory.",-1),rt=i("div",{class:"language-jsx vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"jsx"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"https"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//github.com/jquery/jquery/blob/5c2d08704e289dd2745bcb0557b35a9c0e6af4a4/src/event.js#L798")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ( types "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," types.preventDefault "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," types.handleObj ) {")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"   handleObj "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," types.handleObj;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"   jQuery"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"( types.delegateTarget )."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"off"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       handleObj.namespace "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           handleObj.origType "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "."'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," handleObj.namespace "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           handleObj.origType,")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       handleObj.selector,")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       handleObj.handler")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"   );")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"   return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),ot=i("h2",{id:"server-side-prototype-pollution",tabindex:"-1"},[s("Server-side prototype pollution "),i("a",{class:"header-anchor",href:"#server-side-prototype-pollution","aria-label":'Permalink to "Server-side prototype pollution"'},"​")],-1),kt=i("p",null,[s("It all started with the "),i("a",{href:"https://youtu.be/LUsiFV3dsK8",target:"_blank",rel:"noreferrer"},"Olivier Arteau — Prototype pollution attacks in NodeJS applications"),s("  , "),i("a",{href:"https://github.com/HoLyVieR/prototype-pollution-nsec18",target:"_blank",rel:"noreferrer"},"prototype-pollution-nsec18"),s(".Oliver discovered the prototype pollution vulnerability in "),i("a",{href:"https://hackerone.com/holyvier?filter=type%3Apublic&type=user",target:"_blank",rel:"noreferrer"},"several npm packages"),s(", including one of the most popular "),i("a",{href:"https://www.npmjs.com/package/lodash",target:"_blank",rel:"noreferrer"},"lodash"),s(" packages ( "),i("a",{href:"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3721",target:"_blank",rel:"noreferrer"},"CVE-2018–3721"),s("). The lodash package is used in many applications and packages of the JavaScript ecosystem. In particular, it is used in the popular "),i("a",{href:"https://github.com/TryGhost/Ghost",target:"_blank",rel:"noreferrer"},"Ghost"),s(" CMS")],-1),pt=i("h3",{id:"finding-prototype-pollution",tabindex:"-1"},[s("Finding prototype pollution "),i("a",{class:"header-anchor",href:"#finding-prototype-pollution","aria-label":'Permalink to "Finding prototype pollution"'},"​")],-1),dt=i("p",null,"没有源代码这类漏洞很难被检测和利用(有CVE和现成的payload除外).",-1),ct=i("p",null,"假设,我们有源代码,代码中哪些地方值得被注意,漏洞最常见的地方在哪里?",-1),Et=i("p",null,[i("strong",null,"What language constructs are prone to the vulnerability?")],-1),gt=i("p",null,"Most often, prototype pollution is found in the following constructs / operations:",-1),ut=i("ul",null,[i("li",null,[s("recursive merging of objects (for example, "),i("a",{href:"https://github.com/jonschlinkert/merge-deep",target:"_blank",rel:"noreferrer"},"jonschlinkert/merge-deep"),s(")")]),i("li",null,[s("cloning an object (for example, "),i("a",{href:"https://github.com/jonschlinkert/clone-deep",target:"_blank",rel:"noreferrer"},"jonschlinkert/clone-deep"),s(")")]),i("li",null,[s("converting GET parameters to a JavaScript object (for example, "),i("a",{href:"https://github.com/AceMetrix/jquery-deparam",target:"_blank",rel:"noreferrer"},"AceMetrix/jquery-deparam"),s(")")]),i("li",null,[s("convert "),i("code",null,".toml"),s(" or "),i("code",null,".ini"),s(" configuration files to a JavaScript object (for example, "),i("a",{href:"https://github.com/npm/ini",target:"_blank",rel:"noreferrer"},"npm/ini"),s(")")])],-1),yt=i("p",null,[s("We can trace a pattern: those operations that take a complex data structure (for example, "),i("code",null,".toml"),s(" ) as input and convert it into a JavaScript object are vulnerable")],-1),_t=i("h3",{id:"dynamic-analysis",tabindex:"-1"},[s("Dynamic analysis "),i("a",{class:"header-anchor",href:"#dynamic-analysis","aria-label":'Permalink to "Dynamic analysis"'},"​")],-1),bt=i("p",null,[s("Let’s start with dynamic, as it is easier to understand and apply. The algorithm is quite simple and is already implemented in "),i("a",{href:"https://github.com/HoLyVieR/prototype-pollution-nsec18/tree/master/find-vuln",target:"_blank",rel:"noreferrer"},"find-vuln"),s(":")],-1),mt=i("ol",null,[i("li",null,"Download the npm package."),i("li",null,"Call each function in the package, with a pagelode as an argument."),i("li",null,"Check whether the vulnerability has worked.")],-1),Ft=i("p",null,[s("The only drawback of "),i("a",{href:"https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/find-vuln/find-vuln.js",target:"_blank",rel:"noreferrer"},"find-vuln.js"),s(" is that it doesn’t check "),i("code",null,"constructor.prototype"),s(" and therefore misses some of the vulnerabilities, but this gap is easy enough to fix.In general, making small changes to "),i("a",{href:"https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/find-vuln/find-vuln.js",target:"_blank",rel:"noreferrer"},"find-vuln.js"),s(" even now you can find vulnerabilities in npm packages.")],-1),ft=i("h3",{id:"static-analysis",tabindex:"-1"},[s("static analysis "),i("a",{class:"header-anchor",href:"#static-analysis","aria-label":'Permalink to "static analysis"'},"​")],-1),vt=i("p",null,[i("a",{href:"https://github.com/github/codeql/tree/main/javascript/ql/src/Security/CWE-915",target:"_blank",rel:"noreferrer"},"CodeQL queries")],-1),Ct=i("h3",{id:"impact-1",tabindex:"-1"},[s("impact "),i("a",{class:"header-anchor",href:"#impact-1","aria-label":'Permalink to "impact"'},"​")],-1),jt=i("p",null,"在NodeJS环境里:",-1),At=i("ul",null,[i("li",null,"guaranteed DoS:can overwrite a basic function")],-1),Dt=i("h3",{id:"vuln-in-template-engines",tabindex:"-1"},[s("vuln in template engines "),i("a",{class:"header-anchor",href:"#vuln-in-template-engines","aria-label":'Permalink to "vuln in template engines"'},"​")],-1),wt=i("p",null,"In a web application, often you can spin up to remote code execution. Normally, this is done with the template engines. The details of the operation can be found in the articles below.",-1),Bt=i("ul",null,[i("li",null,[i("a",{href:"https://blog.p6.is/AST-Injection/",target:"_blank",rel:"noreferrer"},"AST Injection, Prototype Pollution to RCE")]),i("li",null,[i("a",{href:"https://blog.p6.is/Real-World-JS-1/",target:"_blank",rel:"noreferrer"},"Real-world JS — 1")]),i("li",null,[i("a",{href:"https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf",target:"_blank",rel:"noreferrer"},"Prototype pollution attack in NodeJS application")])],-1),xt=i("h2",{id:"next-js",tabindex:"-1"},[s("Next.js "),i("a",{class:"header-anchor",href:"#next-js","aria-label":'Permalink to "Next.js"'},"​")],-1),St=i("p",null,"you need know:",-1),Pt=i("ul",null,[i("li",null,"Amp")],-1),Ot=i("p",null,"escape sandbox",-1),Nt=i("p",null,"[16:49]",-1),Rt=i("p",null,[s("![Untitled]("),i("a",{href:"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled",target:"_blank",rel:"noreferrer"},"https://cdn.jsdelivr.net/gh/1dayluo/PicGo4Blog/data/Untitled"),s(" 3.png20220526_a.png)")],-1),Jt=i("h2",{id:"mitigation",tabindex:"-1"},[s("Mitigation "),i("a",{class:"header-anchor",href:"#mitigation","aria-label":'Permalink to "Mitigation"'},"​")],-1),Tt=i("p",null,"两种比较常用的方法:",-1),It=i("ul",null,[i("li",null,"字段黑名单(Field black list)"),i("li",null,"Json模式(JSON schema)")],-1),qt=i("h3",{id:"field-black-list",tabindex:"-1"},[s("Field black list "),i("a",{class:"header-anchor",href:"#field-black-list","aria-label":'Permalink to "Field black list"'},"​")],-1),Vt=i("p",null,[s("大部分开发者是添加 "),i("code",null,"__proto__"),s(" 到黑名单(不推荐)")],-1),Lt=i("p",null,"黑名单推荐:",-1),Ut=i("ul",null,[i("li",null,[i("code",null,"constructor.prototype"),i("ul",null,[i("li",null,"优点:能修复大部分问题,但是同时它没有完全解决问题"),i("li",null,[s("缺点:仍然存在修改 "),i("code",null,"Object.prototype"),s(" 和其他 "),i("code",null,"prototype"),s(" 问题")])])]),i("li",null,[i("code",null,"Object.create(null)"),i("ul",null,[i("li",null,"优点:使用没有prototype的object,这样修改prototype将变得不可能"),i("li",null,[s("缺点:对功能性有些损失,例如有人想用 "),i("code",null,"toString()"),s(" 的场景,但会被提示 "),i("code",null,"o.toString is not a function")])])]),i("li",null,[i("code",null,"Object.freeze()"),i("ul",null,[i("li",null,[s("优点:使用 "),i("code",null,"Object.freeze()"),s(" 来冻结 "),i("code",null,"Object.prototype"),s(" ,这样,在这之后, "),i("code",null,"Object.prototype"),s(" 不能被修改.")]),i("li",null,[s("缺点/pitfalls: "),i("ul",null,[i("li",null,[s("修改 "),i("code",null,"Object.prototype"),s(" 的依赖关系可能被中断")]),i("li",null,[s("通常也需要冻结 "),i("code",null,"Array.prototype"),s(" 和其他object")])])])])])],-1),Mt=i("h3",{id:"json-schema",tabindex:"-1"},[s("JSON schema "),i("a",{class:"header-anchor",href:"#json-schema","aria-label":'Permalink to "JSON schema"'},"​")],-1),Wt=i("p",null,[s("验证通过"),i("a",{href:"https://json-schema.org/",target:"_blank",rel:"noreferrer"},"JSON schema"),s("预定义的输入数据,并丢弃其他参数")],-1),zt=i("p",null,[s("For example, you can do this using the "),i("a",{href:"https://github.com/ajv-validator/ajv",target:"_blank",rel:"noreferrer"},"avj"),s(" library with the "),i("code",null,"additionalProperties = false"),s("  parameter.")],-1),Gt=i("h2",{id:"resource-reference",tabindex:"-1"},[s("Resource&Reference: "),i("a",{class:"header-anchor",href:"#resource-reference","aria-label":'Permalink to "Resource&Reference:"'},"​")],-1),Ht=i("p",null,[i("strong",null,"Video:")],-1),$t=i("ul",null,[i("li",null,[i("a",{href:"https://www.youtube.com/watch?v=XS_UMqQalLI",target:"_blank",rel:"noreferrer"},"https://www.youtube.com/watch?v=XS_UMqQalLI")]),i("li",null,[i("a",{href:"https://www.youtube.com/watch?v=oGeEoaplMWA",target:"_blank",rel:"noreferrer"},"https://www.youtube.com/watch?v=oGeEoaplMWA"),s(),i("strong",null,"DEF CON Safe Mode - Feng Xiao - Discovering Hidden Properties to Attack Node js Ecosystem")])],-1),Qt=i("p",null,[i("strong",null,"Ariticle")],-1),Xt=i("ul",null,[i("li",null,[i("a",{href:"https://brightsec.com/blog/prototype-pollution/",target:"_blank",rel:"noreferrer"},"https://brightsec.com/blog/prototype-pollution/")]),i("li",null,[i("a",{href:"https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html",target:"_blank",rel:"noreferrer"},"https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html"),s(" 推荐 讲的不错")]),i("li",null,[i("a",{href:"https://infosecwriteups.com/javascript-prototype-pollution-practice-of-finding-and-exploitation-f97284333b2",target:"_blank",rel:"noreferrer"},"https://infosecwriteups.com/javascript-prototype-pollution-practice-of-finding-and-exploitation-f97284333b2"),s(" 这个写的好好")])],-1),Kt=i("p",null,[i("strong",null,"Book")],-1),Yt=i("ul",null,[i("li",null,[s("Prototype pollution attack in NodeJS application: "),i("a",{href:"https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf",target:"_blank",rel:"noreferrer"},"https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf")])],-1),Zt=i("p",null,[i("strong",null,"Demo:")],-1),ie=i("ul",null,[i("li",null,[i("a",{href:"https://github.com/PwnFunction/Next.js-Flat-Prototype-Pollution",target:"_blank",rel:"noreferrer"},"https://github.com/PwnFunction/Next.js-Flat-Prototype-Pollution")])],-1),se=i("p",null,[i("strong",null,"github:")],-1),te=i("ul",null,[i("li",null,[i("a",{href:"https://github.com/BlackFan/client-side-prototype-pollution",target:"_blank",rel:"noreferrer"},"https://github.com/BlackFan/client-side-prototype-pollution")])],-1),de={__name:"javascript-prototype-pollution-xue-xi-bi-ji",setup(ee,{expose:o}){const a=JSON.parse('{"title":"Javascript Prototype Pollution 学习笔记","description":"","frontmatter":{"title":"Javascript Prototype Pollution 学习笔记","date":"2022-05-26T20:45:41.000Z","tags":["javascript","学习笔记","prototype pollution"],"published":true,"hideInList":false,"feature":null,"isTop":false},"headers":[{"level":2,"title":"Intro","slug":"intro","link":"#intro","children":[{"level":3,"title":"impact","slug":"impact","link":"#impact","children":[]}]},{"level":2,"title":"Base Knowledege","slug":"base-knowledege","link":"#base-knowledege","children":[{"level":3,"title":"理解object","slug":"理解object","link":"#理解object","children":[]},{"level":3,"title":"Property access","slug":"property-access","link":"#property-access","children":[]},{"level":3,"title":"Object prototype","slug":"object-prototype","link":"#object-prototype","children":[]},{"level":3,"title":"__proto__ 和 prototype的区别","slug":"proto-和-prototype的区别","link":"#proto-和-prototype的区别","children":[]},{"level":3,"title":"原型链继承","slug":"原型链继承","link":"#原型链继承","children":[]}]},{"level":2,"title":"What is prototype pollution?","slug":"what-is-prototype-pollution","link":"#what-is-prototype-pollution","children":[]},{"level":2,"title":"base sample:","slug":"base-sample","link":"#base-sample","children":[]},{"level":2,"title":"Detection","slug":"detection","link":"#detection","children":[{"level":3,"title":"Case 1","slug":"case-1","link":"#case-1","children":[]},{"level":3,"title":"Case 2","slug":"case-2","link":"#case-2","children":[]},{"level":3,"title":"Property definition by path/location","slug":"property-definition-by-path-location","link":"#property-definition-by-path-location","children":[]},{"level":3,"title":"**vulnerable document.location parsers","slug":"vulnerable-document-location-parsers","link":"#vulnerable-document-location-parsers","children":[]}]},{"level":2,"title":"Identifying the vulnerable library","slug":"identifying-the-vulnerable-library","link":"#identifying-the-vulnerable-library","children":[{"level":3,"title":"Blocking the JS resource request in Firefox","slug":"blocking-the-js-resource-request-in-firefox","link":"#blocking-the-js-resource-request-in-firefox","children":[]},{"level":3,"title":"Debugger Breakpoint on setter","slug":"debugger-breakpoint-on-setter","link":"#debugger-breakpoint-on-setter","children":[]},{"level":3,"title":"sensitive function","slug":"sensitive-function","link":"#sensitive-function","children":[]}]},{"level":2,"title":"Finding Script Gadgets","slug":"finding-script-gadgets","link":"#finding-script-gadgets","children":[{"level":3,"title":"What is a script gadget?","slug":"what-is-a-script-gadget","link":"#what-is-a-script-gadget","children":[]},{"level":3,"title":"using existing gadgets","slug":"using-existing-gadgets","link":"#using-existing-gadgets","children":[]},{"level":3,"title":"👏 Finding new gadgets","slug":"👏-finding-new-gadgets","link":"#👏-finding-new-gadgets","children":[]},{"level":3,"title":"Keyword search and Source Code Review","slug":"keyword-search-and-source-code-review","link":"#keyword-search-and-source-code-review","children":[]},{"level":3,"title":"jQuery example","slug":"jquery-example","link":"#jquery-example","children":[]}]},{"level":2,"title":"Server-side prototype pollution","slug":"server-side-prototype-pollution","link":"#server-side-prototype-pollution","children":[{"level":3,"title":"Finding prototype pollution","slug":"finding-prototype-pollution","link":"#finding-prototype-pollution","children":[]},{"level":3,"title":"Dynamic analysis","slug":"dynamic-analysis","link":"#dynamic-analysis","children":[]},{"level":3,"title":"static analysis","slug":"static-analysis","link":"#static-analysis","children":[]},{"level":3,"title":"impact","slug":"impact-1","link":"#impact-1","children":[]},{"level":3,"title":"vuln in template engines","slug":"vuln-in-template-engines","link":"#vuln-in-template-engines","children":[]}]},{"level":2,"title":"Next.js","slug":"next-js","link":"#next-js","children":[]},{"level":2,"title":"Mitigation","slug":"mitigation","link":"#mitigation","children":[{"level":3,"title":"Field black list","slug":"field-black-list","link":"#field-black-list","children":[]},{"level":3,"title":"JSON schema","slug":"json-schema","link":"#json-schema","children":[]}]},{"level":2,"title":"Resource&Reference:","slug":"resource-reference","link":"#resource-reference","children":[]}],"relativePath":"pages/posts/history/javascript-prototype-pollution-xue-xi-bi-ji.md","path":"/home/runner/work/1dayluo.github.io/1dayluo.github.io/pages/posts/history/javascript-prototype-pollution-xue-xi-bi-ji.md","lastUpdated":1714218709000}'),h=d(),n=a.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},a.frontmatter||{}),r("pageData",a),r("valaxy:frontmatter",n),globalThis.$frontmatter=n,o({frontmatter:{title:"Javascript Prototype Pollution 学习笔记",date:"2022-05-26T20:45:41.000Z",tags:["javascript","学习笔记","prototype pollution"],published:!0,hideInList:!1,feature:null,isTop:!1}}),(e,ae)=>{const k=p;return c(),E(k,{frontmatter:g(n)},{"main-content-md":t(()=>[u,y,_,b,m,F,f,v,C,j,A,D,w,B,x,S,P,O,N,R,J,T,I,q,V,L,U,M,W,z,G,H,$,Q,X,K,Y,Z,ii,si,ti,ei,li,ai,ni,hi,ri,oi,ki,pi,di,ci,Ei,gi,ui,yi,_i,bi,mi,Fi,fi,vi,Ci,ji,Ai,Di,wi,Bi,xi,Si,Pi,Oi,Ni,Ri,Ji,Ti,Ii,qi,Vi,Li,Ui,Mi,Wi,zi,Gi,Hi,$i,Qi,Xi,Ki,Yi,Zi,is,ss,ts,es,ls,as,ns,hs,rs,os,ks,ps,ds,cs,Es,gs,us,ys,_s,bs,ms,Fs,fs,vs,Cs,js,As,Ds,ws,Bs,xs,Ss,Ps,Os,Ns,Rs,Js,Ts,Is,qs,Vs,Ls,Us,Ms,Ws,zs,Gs,Hs,$s,Qs,Xs,Ks,Ys,Zs,it,st,tt,et,lt,at,nt,ht,rt,ot,kt,pt,dt,ct,Et,gt,ut,yt,_t,bt,mt,Ft,ft,vt,Ct,jt,At,Dt,wt,Bt,xt,St,Pt,Ot,Nt,Rt,Jt,Tt,It,qt,Vt,Lt,Ut,Mt,Wt,zt,Gt,Ht,$t,Qt,Xt,Kt,Yt,Zt,ie,se,te]),"main-header":t(()=>[l(e.$slots,"main-header")]),"main-header-after":t(()=>[l(e.$slots,"main-header-after")]),"main-nav":t(()=>[l(e.$slots,"main-nav")]),"main-content":t(()=>[l(e.$slots,"main-content")]),"main-content-after":t(()=>[l(e.$slots,"main-content-after")]),"main-nav-before":t(()=>[l(e.$slots,"main-nav-before")]),"main-nav-after":t(()=>[l(e.$slots,"main-nav-after")]),comment:t(()=>[l(e.$slots,"comment")]),footer:t(()=>[l(e.$slots,"footer")]),aside:t(()=>[l(e.$slots,"aside")]),"aside-custom":t(()=>[l(e.$slots,"aside-custom")]),default:t(()=>[l(e.$slots,"default")]),_:3},8,["frontmatter"])}}};export{de as default};
